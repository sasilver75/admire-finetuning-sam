Training run on Dec3 overnight (7b 4bit Lora)
https://wandb.ai/sam-silver/qwen2-7b-instruct-trl-sft/runs/x017i311?nw=nwusersamsilver
Uploaded to
https://huggingface.co/UCSC-Admire/Qwen2-VL-7B-Instruct-finetune-2024-12-04_02-08-26
It's just the LoRA adapters, not the full model.

Trained using:
def main():
    # Load training dataset
    print("Loading dataset...")
    dataset = load_dataset(DATASET_NAME, split="train")
    print(f"Dataset size: {len(dataset)}")
    dataset_dict = dataset.train_test_split(test_size=0.05, seed=42) # Use 5% of the training split as evaluation
    print("Processing datasets...")
    # train_dataset = dataset_dict["train"].map(
    #     format_data,
    #     batched=False,
    #     # batch_size=32,
    #     num_proc=1,
    #     remove_columns=dataset_dict["train"].column_names,
    #     load_from_cache_file=False,  # Disable caching
    #     keep_in_memory=False # Not sure what this does yet, but o1 thinks it exists and matters?
    # )
    # print(f"Mapped training data")
    # eval_dataset = dataset_dict["test"].map(
    #     format_data,
    #     batched=False,
    #     # batch_size=32,
    #     num_proc=1,
    #     remove_columns=dataset_dict["test"].column_names,
    #     load_from_cache_file=False,  # Disable caching
    #     keep_in_memory=False # Not sure what this does yet, but o1 thinks it exists and matters?
    # )
    # print(f"Mapped evaluation data")
    # print(f"Train dataset size: {len(train_dataset)}")
    # print(f"Eval dataset size: {len(eval_dataset)}")

    # Process the datasets
    # print("Processing datasets...")
    train_dataset = dataset_dict["train"]
    test_dataset = dataset_dict["test"]
    train_dataset = [format_data(sample) for sample in tqdm(train_dataset, desc="Processing train data")]
    eval_dataset = [format_data(sample) for sample in tqdm(test_dataset, desc="Processing eval data")]

    # Create Bits and Bytes Config
    # The model's weights are quantized to 4-bit, but the computations (activations, gradients) are done in bfloat16 for better numerical stability. 
    # This combination gives you both memory efficiency (from 4-bit quantization) and training stability (from bfloat16 compute).
    bnb_config = BitsAndBytesConfig(
        load_in_4bit=True, bnb_4bit_use_double_quant=True, bnb_4bit_quant_type="nf4", bnb_4bit_compute_dtype=torch.bfloat16
    )
    # Load the model
    print("Loading model...")
    model = Qwen2VLForConditionalGeneration.from_pretrained(
        pretrained_model_name_or_path=f"{MODEL_ORG_NAME}/{MODEL_NAME}",
        device_map="auto",
        torch_dtype=torch.bfloat16,
        quantization_config=bnb_config,
    )
    print("Loading processor...")
    global processor
    processor = Qwen2VLProcessor.from_pretrained(
        f"{MODEL_ORG_NAME}/{MODEL_NAME}",
        min_pixels=256*28*28,  # Minimum number of pixels (256 tokens)
        max_pixels=384*28*28   # Maximum number of pixels (384 tokens instead of 1024 for memory savings)
    )

    # Configure QLoRA (Unlike standard LoRA, which reduces memory by applying a low-rank approximation,
    # takes it a step further by quantizing the weights of the LoRA adapters, leading to even lower memory requirements)
    peft_config = LoraConfig(
        lora_alpha=16,
        lora_dropout=0.05,
        r=8,
        bias="none",
        target_modules=["q_proj", "v_proj"],
        task_type="CAUSAL_LM"
    )

    # Apply PEFT model adaptation
    peft_model = get_peft_model(model, peft_config)

    # Print the trainable parameters
    peft_model.print_trainable_parameters()

    # Configure training arguments
    now = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    training_args = SFTConfig(
        output_dir="qwen2-7b-instruct-trl-sft-ADMIRE",  # Directory to save the model
        num_train_epochs=3,  # Number of training epochs
        per_device_train_batch_size=1,  # Batch size for training
        per_device_eval_batch_size=1,  # Batch size for evaluation
        gradient_accumulation_steps=8,  # Steps to accumulate gradients
        gradient_checkpointing=True,  # Enable gradient checkpointing for memory efficiency
        # Optimizer and scheduler settings
        optim="adamw_torch_fused",  # Optimizer type
        learning_rate=2e-4,  # Learning rate for training
        lr_scheduler_type="constant",  # Type of learning rate scheduler
        # Logging and evaluation
        logging_steps=10,  # Steps interval for logging
        eval_steps=20,  # Steps interval for evaluation
        eval_strategy="steps",  # Strategy for evaluation
        save_strategy="steps",  # Strategy for saving the model
        save_steps=20,  # Steps interval for saving
        metric_for_best_model="eval_loss",  # Metric to evaluate the best model
        greater_is_better=False,  # Whether higher metric values are better
        load_best_model_at_end=True,  # Load the best model after training
        # Mixed precision and gradient settings
        bf16=True,  # Use bfloat16 precision
        tf32=True,  # Use TensorFloat-32 precision
        max_grad_norm=0.3,  # Maximum norm for gradient clipping
        warmup_ratio=0.03,  # Ratio of total steps for warmup
        # Hub and reporting
        push_to_hub=True,  # Whether to push model to Hugging Face Hub
        hub_model_id=f"UCSC-Admire/Qwen2-VL-7B-Instruct-finetune-{now}",
        hub_token=hf_token,
        report_to="wandb",  # Reporting tool for tracking metrics
        # Gradient checkpointing settings
        gradient_checkpointing_kwargs={"use_reentrant": False},  # Options for gradient checkpointing
        # Dataset configuration
        dataset_text_field="",  # Text field in dataset
        dataset_kwargs={"skip_prepare_dataset": True},  # Additional dataset options
        # max_seq_length=1024  # Maximum sequence length for input
    )
    training_args.remove_unused_columns = False  # Keep unused columns in dataset

    # Conecting to weights and biases
    wandb.init(
        project="qwen2-7b-instruct-trl-sft",
        name=f"qwen2-7b-instruct-trl-sft-{now}",
        config=training_args
    )

    # Try generating text from a sample, does it work? Yes!
    sample = train_dataset[0]
    generated_text = generate_text_from_sample(peft_model, processor, sample)
    print(generated_text)

    trainer = SFTTrainer(
        model=peft_model,
        args=training_args,
        train_dataset=train_dataset,
        eval_dataset=eval_dataset,
        data_collator=collate_fn,
        # peft_config=peft_config, # It seems you can either pass the model + peft config or peft_model (Their way in the tutorial isn't obviously supported from the @HFQwen tutorial)
        tokenizer=processor.tokenizer,
    )

    # Train the model!
    print("Training the model...")
    trainer.train()

    print(f"Saving model to {training_args.output_dir}...")
    trainer.save_model(training_args.output_dir)

Full output:
(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$ /home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/bin/python /home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/train.py
Loading dataset...
Dataset size: 3996
Processing datasets...
Processing train data: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 3796/3796 [03:34<00:00, 17.71it/s]
Processing eval data: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:11<00:00, 17.40it/s]
Loading model...
`Qwen2VLRotaryEmbedding` can now be fully parameterized by passing the model config through the `config` argument. All other arguments will be removed in v4.46
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:02<00:00,  2.16it/s]
Loading processor...
trainable params: 2,523,136 || all params: 8,293,898,752 || trainable%: 0.0304
wandb: Using wandb-core as the SDK backend.  Please refer to https://wandb.me/wandb-core for more information.
wandb: Currently logged in as: sam-silver. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.18.7
wandb: Run data is saved locally in /home/sam/code/ucsc/243/admire/admire-finetuning-sam/wandb/run-20241204_020826-x017i311
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run qwen2-7b-instruct-trl-sft-2024-12-04_02-08-26
wandb: ⭐️ View project at https://wandb.ai/sam-silver/qwen2-7b-instruct-trl-sft
wandb: 🚀 View run at https://wandb.ai/sam-silver/qwen2-7b-instruct-trl-sft/runs/x017i311
E, B, C, A, D
/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/trl/trainer/sft_trainer.py:309: UserWarning: You didn't pass a `max_seq_length` argument to the SFTTrainer, this will default to 1024
  warnings.warn(
/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/trl/trainer/sft_trainer.py:403: UserWarning: You passed a processing_class with `padding_side` not equal to `right` to the SFTTrainer. This might lead to some unexpected behaviour due to overflow issues when training a model in half-precision. You might consider adding `processing_class.padding_side = 'right'` to your code.
  warnings.warn(
Training the model...
wandb: WARNING The `run_name` is currently set to the same value as `TrainingArguments.output_dir`. If this was not intended, please specify a different run name by setting the `TrainingArguments.run_name` parameter.
  0%|                                                                                                                                            | 0/1422 [00:00<?, ?it/s]`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`...
{'loss': 14.5599, 'grad_norm': 34.986446380615234, 'learning_rate': 0.0002, 'epoch': 0.02}                                                                                
{'loss': 11.969, 'grad_norm': 41.593055725097656, 'learning_rate': 0.0002, 'epoch': 0.04}                                                                                 
{'eval_loss': 10.192072868347168, 'eval_runtime': 216.9975, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 0.04}                              
{'loss': 9.1731, 'grad_norm': 23.609970092773438, 'learning_rate': 0.0002, 'epoch': 0.06}                                                                                 
{'loss': 7.7688, 'grad_norm': 9.070549011230469, 'learning_rate': 0.0002, 'epoch': 0.08}                                                                                  
{'eval_loss': 7.394049167633057, 'eval_runtime': 216.4574, 'eval_samples_per_second': 0.924, 'eval_steps_per_second': 0.924, 'epoch': 0.08}                               
{'loss': 7.2259, 'grad_norm': 3.8098530769348145, 'learning_rate': 0.0002, 'epoch': 0.11}                                                                                 
{'loss': 6.9608, 'grad_norm': 3.804227590560913, 'learning_rate': 0.0002, 'epoch': 0.13}                                                                                  
  4%|█████▍                                                                                                                           | 60/1422 [18:37<4:19:58, 11.45s/it]
 40%|█████████████████████████████████████████████████████▍                                                                              | 81/200 [01:27<02:
 41%|████████████████▍                       | 82/200 [01:28<02:12,  1.13s/it]                                                                                                                                                            {'eval_loss': 6.836002349853516, 'eval_runtime': 218.5503, 'eval_samples_per_second': 0.915, 'eval_steps_per_second': 0.915, 'epoch': 0.13}                 
{'loss': 6.7791, 'grad_norm': 1.8830714225769043, 'learning_rate': 0.0002, 'epoch': 0.15}                                                                   
{'loss': 6.705, 'grad_norm': 1.4071476459503174, 'learning_rate': 0.0002, 'epoch': 0.17}
{'eval_loss': 6.676995277404785, 'eval_runtime': 217.7209, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 0.17}                 
{'loss': 6.664, 'grad_norm': 1.7235758304595947, 'learning_rate': 0.0002, 'epoch': 0.19}                                                                    
{'loss': 6.6296, 'grad_norm': 1.2654249668121338, 'learning_rate': 0.0002, 'epoch': 0.21}
{'eval_loss': 6.618938446044922, 'eval_runtime': 217.5722, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 0.21}                 
{'loss': 6.6085, 'grad_norm': 1.3803859949111938, 'learning_rate': 0.0002, 'epoch': 0.23}                                                                   
{'loss': 6.5978, 'grad_norm': 1.1433502435684204, 'learning_rate': 0.0002, 'epoch': 0.25}
{'eval_loss': 6.59084415435791, 'eval_runtime': 217.3591, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 0.25}                    
{'loss': 6.5862, 'grad_norm': 1.373647689819336, 'learning_rate': 0.0002, 'epoch': 0.27}                                                                    
{'loss': 6.5767, 'grad_norm': 0.8999692797660828, 'learning_rate': 0.0002, 'epoch': 0.3}
{'eval_loss': 6.574965953826904, 'eval_runtime': 217.6695, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 0.3}                  
{'loss': 6.5755, 'grad_norm': 0.8763388395309448, 'learning_rate': 0.0002, 'epoch': 0.32}                                                                   
{'loss': 6.5657, 'grad_norm': 1.1560187339782715, 'learning_rate': 0.0002, 'epoch': 0.34}
{'eval_loss': 6.566245079040527, 'eval_runtime': 216.8846, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 0.34}                 
{'loss': 6.5652, 'grad_norm': 0.8728417754173279, 'learning_rate': 0.0002, 'epoch': 0.36}                                                                   
{'loss': 6.5624, 'grad_norm': 0.8472049236297607, 'learning_rate': 0.0002, 'epoch': 0.38}
{'eval_loss': 6.560461521148682, 'eval_runtime': 217.5198, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 0.38}                 
{'loss': 6.5611, 'grad_norm': 0.8779647946357727, 'learning_rate': 0.0002, 'epoch': 0.4}                                                                    
{'loss': 6.5617, 'grad_norm': 1.6122158765792847, 'learning_rate': 0.0002, 'epoch': 0.42}
{'eval_loss': 6.558502197265625, 'eval_runtime': 216.8722, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 0.42}                 
{'loss': 6.5584, 'grad_norm': 0.887953519821167, 'learning_rate': 0.0002, 'epoch': 0.44}                                                                    
{'loss': 6.5576, 'grad_norm': 1.9873360395431519, 'learning_rate': 0.0002, 'epoch': 0.46}
{'eval_loss': 6.554995536804199, 'eval_runtime': 216.9772, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 0.46}                 
{'loss': 6.554, 'grad_norm': 0.884396493434906, 'learning_rate': 0.0002, 'epoch': 0.48}                                                                     
{'loss': 6.557, 'grad_norm': 1.0201518535614014, 'learning_rate': 0.0002, 'epoch': 0.51}
{'eval_loss': 6.552361965179443, 'eval_runtime': 217.2781, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 0.51}                   
{'loss': 6.555, 'grad_norm': 1.0064772367477417, 'learning_rate': 0.0002, 'epoch': 0.53}                                                                    
{'loss': 6.5536, 'grad_norm': 1.1933047771453857, 'learning_rate': 0.0002, 'epoch': 0.55}
{'eval_loss': 6.55119514465332, 'eval_runtime': 217.3754, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 0.55}                    
{'loss': 6.549, 'grad_norm': 1.6864283084869385, 'learning_rate': 0.0002, 'epoch': 0.57}                                                                    
{'loss': 6.5498, 'grad_norm': 0.8392448425292969, 'learning_rate': 0.0002, 'epoch': 0.59}
{'eval_loss': 6.549632549285889, 'eval_runtime': 216.8917, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 0.59}                 
{'loss': 6.5487, 'grad_norm': 0.6557180881500244, 'learning_rate': 0.0002, 'epoch': 0.61}                                                                   
{'loss': 6.5481, 'grad_norm': 1.028131127357483, 'learning_rate': 0.0002, 'epoch': 0.63}
{'eval_loss': 6.548847675323486, 'eval_runtime': 217.5811, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 0.63}                 
{'loss': 6.5476, 'grad_norm': 2.1891446113586426, 'learning_rate': 0.0002, 'epoch': 0.65}                                                                   
{'loss': 6.5495, 'grad_norm': 1.0202306509017944, 'learning_rate': 0.0002, 'epoch': 0.67}
{'eval_loss': 6.54798698425293, 'eval_runtime': 217.1783, 'eval_samples_per_second': 0.921, 'eval_steps_per_second': 0.921, 'epoch': 0.67}                  
{'loss': 6.5477, 'grad_norm': 0.9665899872779846, 'learning_rate': 0.0002, 'epoch': 0.7}                                                                    
{'loss': 6.5512, 'grad_norm': 1.810166358947754, 'learning_rate': 0.0002, 'epoch': 0.72}
{'eval_loss': 6.547818183898926, 'eval_runtime': 216.8225, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 0.72}                 
{'loss': 6.5437, 'grad_norm': 0.86532062292099, 'learning_rate': 0.0002, 'epoch': 0.74}                                                                     
{'loss': 6.545, 'grad_norm': 1.2096692323684692, 'learning_rate': 0.0002, 'epoch': 0.76}
{'eval_loss': 6.546828746795654, 'eval_runtime': 217.0878, 'eval_samples_per_second': 0.921, 'eval_steps_per_second': 0.921, 'epoch': 0.76}                 
{'loss': 6.5443, 'grad_norm': 1.6057759523391724, 'learning_rate': 0.0002, 'epoch': 0.78}                                                                   
{'loss': 6.5464, 'grad_norm': 1.3156195878982544, 'learning_rate': 0.0002, 'epoch': 0.8}
{'eval_loss': 6.545684814453125, 'eval_runtime': 216.847, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 0.8}                   
{'loss': 6.5453, 'grad_norm': 1.1898847818374634, 'learning_rate': 0.0002, 'epoch': 0.82}                                                                   
{'loss': 6.5431, 'grad_norm': 0.8452103734016418, 'learning_rate': 0.0002, 'epoch': 0.84}
{'eval_loss': 6.545263290405273, 'eval_runtime': 217.4336, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 0.84}                   
{'loss': 6.5468, 'grad_norm': 0.7921375632286072, 'learning_rate': 0.0002, 'epoch': 0.86}                                                                   
{'loss': 6.5466, 'grad_norm': 0.5913310647010803, 'learning_rate': 0.0002, 'epoch': 0.89}
{'eval_loss': 6.544809341430664, 'eval_runtime': 217.5789, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 0.89}                 
{'loss': 6.5396, 'grad_norm': 1.5439060926437378, 'learning_rate': 0.0002, 'epoch': 0.91}                                                                   
{'loss': 6.5453, 'grad_norm': 1.7771459817886353, 'learning_rate': 0.0002, 'epoch': 0.93}
{'eval_loss': 6.5445709228515625, 'eval_runtime': 217.192, 'eval_samples_per_second': 0.921, 'eval_steps_per_second': 0.921, 'epoch': 0.93}                 
{'loss': 6.5434, 'grad_norm': 0.6397672891616821, 'learning_rate': 0.0002, 'epoch': 0.95}                                                                   
{'loss': 6.5436, 'grad_norm': 0.7425759434700012, 'learning_rate': 0.0002, 'epoch': 0.97}
{'eval_loss': 6.543883800506592, 'eval_runtime': 216.8095, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 0.97}                 
{'loss': 6.5435, 'grad_norm': 0.6350188851356506, 'learning_rate': 0.0002, 'epoch': 0.99}                                                                   
{'loss': 6.5445, 'grad_norm': 0.6900752186775208, 'learning_rate': 0.0002, 'epoch': 1.01}
{'eval_loss': 6.543856143951416, 'eval_runtime': 216.3186, 'eval_samples_per_second': 0.925, 'eval_steps_per_second': 0.925, 'epoch': 1.01}                 
{'loss': 6.5423, 'grad_norm': 0.7928141951560974, 'learning_rate': 0.0002, 'epoch': 1.03}                                                                   
{'loss': 6.5414, 'grad_norm': 0.6406348943710327, 'learning_rate': 0.0002, 'epoch': 1.05}
{'eval_loss': 6.54304313659668, 'eval_runtime': 217.4093, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.05}                    
{'loss': 6.5445, 'grad_norm': 1.5565091371536255, 'learning_rate': 0.0002, 'epoch': 1.07}                                                                   
{'loss': 6.541, 'grad_norm': 2.135701894760132, 'learning_rate': 0.0002, 'epoch': 1.1}
{'eval_loss': 6.542945384979248, 'eval_runtime': 217.4922, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.1}                    
{'loss': 6.5423, 'grad_norm': 0.9600397944450378, 'learning_rate': 0.0002, 'epoch': 1.12}                                                                   
{'loss': 6.5436, 'grad_norm': 0.8412309288978577, 'learning_rate': 0.0002, 'epoch': 1.14}
{'eval_loss': 6.542717933654785, 'eval_runtime': 216.7765, 'eval_samples_per_second': 0.923, 'eval_steps_per_second': 0.923, 'epoch': 1.14}                 
{'loss': 6.5438, 'grad_norm': 0.9565261006355286, 'learning_rate': 0.0002, 'epoch': 1.16}                                                                   
{'loss': 6.5409, 'grad_norm': 0.85605788230896, 'learning_rate': 0.0002, 'epoch': 1.18}
{'eval_loss': 6.541419506072998, 'eval_runtime': 217.5713, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 1.18}                 
{'loss': 6.5394, 'grad_norm': 0.6049232482910156, 'learning_rate': 0.0002, 'epoch': 1.2}                                                                    
{'loss': 6.5441, 'grad_norm': 1.7690421342849731, 'learning_rate': 0.0002, 'epoch': 1.22}
{'eval_loss': 6.542033672332764, 'eval_runtime': 217.4841, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.22}                   
{'loss': 6.5418, 'grad_norm': 0.9066015481948853, 'learning_rate': 0.0002, 'epoch': 1.24}                                                                   
{'loss': 6.5389, 'grad_norm': 0.8122724890708923, 'learning_rate': 0.0002, 'epoch': 1.26}
{'eval_loss': 6.541242599487305, 'eval_runtime': 217.4131, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.26}                   
{'loss': 6.5405, 'grad_norm': 0.7895008325576782, 'learning_rate': 0.0002, 'epoch': 1.29}                                                                   
{'loss': 6.5422, 'grad_norm': 1.7510417699813843, 'learning_rate': 0.0002, 'epoch': 1.31}
{'eval_loss': 6.5413103103637695, 'eval_runtime': 216.3576, 'eval_samples_per_second': 0.924, 'eval_steps_per_second': 0.924, 'epoch': 1.31}                
{'loss': 6.5366, 'grad_norm': 0.7941744923591614, 'learning_rate': 0.0002, 'epoch': 1.33}                                                                   
{'loss': 6.5413, 'grad_norm': 0.7577549815177917, 'learning_rate': 0.0002, 'epoch': 1.35}
{'eval_loss': 6.540406703948975, 'eval_runtime': 217.4549, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.35}                   
{'loss': 6.5474, 'grad_norm': 1.108428716659546, 'learning_rate': 0.0002, 'epoch': 1.37}                                                                    
{'loss': 6.5347, 'grad_norm': 1.2479267120361328, 'learning_rate': 0.0002, 'epoch': 1.39}
{'eval_loss': 6.540256500244141, 'eval_runtime': 217.6427, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 1.39}                 
{'loss': 6.5378, 'grad_norm': 0.6393293142318726, 'learning_rate': 0.0002, 'epoch': 1.41}                                                                   
{'loss': 6.5368, 'grad_norm': 1.7365397214889526, 'learning_rate': 0.0002, 'epoch': 1.43}
{'eval_loss': 6.539330959320068, 'eval_runtime': 216.986, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 1.43}                  
{'loss': 6.5402, 'grad_norm': 0.9725116491317749, 'learning_rate': 0.0002, 'epoch': 1.45}                                                                   
{'loss': 6.5381, 'grad_norm': 0.7056076526641846, 'learning_rate': 0.0002, 'epoch': 1.48}
{'eval_loss': 6.538913726806641, 'eval_runtime': 217.4157, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.48}                   
{'loss': 6.5366, 'grad_norm': 0.6957536935806274, 'learning_rate': 0.0002, 'epoch': 1.5}                                                                    
{'loss': 6.5361, 'grad_norm': 0.7672606706619263, 'learning_rate': 0.0002, 'epoch': 1.52}
{'eval_loss': 6.538872718811035, 'eval_runtime': 217.0916, 'eval_samples_per_second': 0.921, 'eval_steps_per_second': 0.921, 'epoch': 1.52}                 
{'loss': 6.5384, 'grad_norm': 1.8489184379577637, 'learning_rate': 0.0002, 'epoch': 1.54}                                                                   
{'loss': 6.5411, 'grad_norm': 1.3434791564941406, 'learning_rate': 0.0002, 'epoch': 1.56}
{'eval_loss': 6.538256645202637, 'eval_runtime': 216.2692, 'eval_samples_per_second': 0.925, 'eval_steps_per_second': 0.925, 'epoch': 1.56}                 
{'loss': 6.538, 'grad_norm': 1.0617250204086304, 'learning_rate': 0.0002, 'epoch': 1.58}                                                                    
{'loss': 6.5368, 'grad_norm': 1.1498390436172485, 'learning_rate': 0.0002, 'epoch': 1.6}
{'eval_loss': 6.53839111328125, 'eval_runtime': 216.9472, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 1.6}                   
{'loss': 6.5415, 'grad_norm': 0.7946908473968506, 'learning_rate': 0.0002, 'epoch': 1.62}                                                                   
{'loss': 6.542, 'grad_norm': 0.6868600249290466, 'learning_rate': 0.0002, 'epoch': 1.64}
{'eval_loss': 6.537642955780029, 'eval_runtime': 217.292, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.64}                    
{'loss': 6.5345, 'grad_norm': 0.7983841300010681, 'learning_rate': 0.0002, 'epoch': 1.66}                                                                   
{'loss': 6.5375, 'grad_norm': 0.5471001863479614, 'learning_rate': 0.0002, 'epoch': 1.69}
{'eval_loss': 6.537357330322266, 'eval_runtime': 217.3439, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.69}                   
{'loss': 6.5359, 'grad_norm': 0.6578023433685303, 'learning_rate': 0.0002, 'epoch': 1.71}                                                                   
{'loss': 6.5385, 'grad_norm': 0.5735700726509094, 'learning_rate': 0.0002, 'epoch': 1.73}
{'eval_loss': 6.537294864654541, 'eval_runtime': 217.037, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 1.73}                  
{'loss': 6.5375, 'grad_norm': 1.0897740125656128, 'learning_rate': 0.0002, 'epoch': 1.75}                                                                   
{'loss': 6.5378, 'grad_norm': 0.8301168084144592, 'learning_rate': 0.0002, 'epoch': 1.77}
{'eval_loss': 6.536708354949951, 'eval_runtime': 216.8502, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 1.77}                 
{'loss': 6.5341, 'grad_norm': 0.8333432674407959, 'learning_rate': 0.0002, 'epoch': 1.79}                                                                   
{'loss': 6.5306, 'grad_norm': 0.8477818965911865, 'learning_rate': 0.0002, 'epoch': 1.81}
{'eval_loss': 6.536574840545654, 'eval_runtime': 217.3991, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.81}                   
{'loss': 6.5374, 'grad_norm': 1.0242862701416016, 'learning_rate': 0.0002, 'epoch': 1.83}                                                                   
{'loss': 6.5316, 'grad_norm': 1.3376548290252686, 'learning_rate': 0.0002, 'epoch': 1.85}
{'eval_loss': 6.535946846008301, 'eval_runtime': 217.3853, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.85}                   
{'loss': 6.538, 'grad_norm': 1.4064669609069824, 'learning_rate': 0.0002, 'epoch': 1.88}                                                                    
{'loss': 6.5338, 'grad_norm': 0.9091357588768005, 'learning_rate': 0.0002, 'epoch': 1.9}
{'eval_loss': 6.535383224487305, 'eval_runtime': 217.4253, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.9}                    
{'loss': 6.5319, 'grad_norm': 1.1205101013183594, 'learning_rate': 0.0002, 'epoch': 1.92}                                                                   
{'loss': 6.5347, 'grad_norm': 0.8652428388595581, 'learning_rate': 0.0002, 'epoch': 1.94}
{'eval_loss': 6.535790920257568, 'eval_runtime': 217.6216, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 1.94}                 
{'loss': 6.5312, 'grad_norm': 1.1067525148391724, 'learning_rate': 0.0002, 'epoch': 1.96}                                                                   
{'loss': 6.533, 'grad_norm': 1.629784345626831, 'learning_rate': 0.0002, 'epoch': 1.98}
{'eval_loss': 6.534569263458252, 'eval_runtime': 217.4308, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 1.98}                   
{'loss': 6.5336, 'grad_norm': 0.6292194128036499, 'learning_rate': 0.0002, 'epoch': 2.0}                                                                    
{'loss': 6.534, 'grad_norm': 0.6860976219177246, 'learning_rate': 0.0002, 'epoch': 2.02}
{'eval_loss': 6.534357070922852, 'eval_runtime': 215.7078, 'eval_samples_per_second': 0.927, 'eval_steps_per_second': 0.927, 'epoch': 2.02}                 
{'loss': 6.5338, 'grad_norm': 0.7156447768211365, 'learning_rate': 0.0002, 'epoch': 2.04}                                                                   
{'loss': 6.5338, 'grad_norm': 1.3718966245651245, 'learning_rate': 0.0002, 'epoch': 2.07}
{'eval_loss': 6.534129619598389, 'eval_runtime': 216.5097, 'eval_samples_per_second': 0.924, 'eval_steps_per_second': 0.924, 'epoch': 2.07}                 
{'loss': 6.5321, 'grad_norm': 1.0382860898971558, 'learning_rate': 0.0002, 'epoch': 2.09}                                                                   
{'loss': 6.5357, 'grad_norm': 1.1995114088058472, 'learning_rate': 0.0002, 'epoch': 2.11}
{'eval_loss': 6.533881664276123, 'eval_runtime': 217.6673, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 2.11}                 
{'loss': 6.5325, 'grad_norm': 1.2206414937973022, 'learning_rate': 0.0002, 'epoch': 2.13}                                                                   
{'loss': 6.5304, 'grad_norm': 0.7350754141807556, 'learning_rate': 0.0002, 'epoch': 2.15}
{'eval_loss': 6.533408164978027, 'eval_runtime': 217.1263, 'eval_samples_per_second': 0.921, 'eval_steps_per_second': 0.921, 'epoch': 2.15}                 
{'loss': 6.5301, 'grad_norm': 0.7390842437744141, 'learning_rate': 0.0002, 'epoch': 2.17}                                                                   
{'loss': 6.5264, 'grad_norm': 0.9482393860816956, 'learning_rate': 0.0002, 'epoch': 2.19}
{'eval_loss': 6.533235549926758, 'eval_runtime': 217.5955, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 2.19}                 
{'loss': 6.5359, 'grad_norm': 0.6184854507446289, 'learning_rate': 0.0002, 'epoch': 2.21}                                                                   
{'loss': 6.5322, 'grad_norm': 1.4181545972824097, 'learning_rate': 0.0002, 'epoch': 2.23}
{'eval_loss': 6.5335373878479, 'eval_runtime': 216.9491, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 2.23}                   
{'loss': 6.5309, 'grad_norm': 1.2800315618515015, 'learning_rate': 0.0002, 'epoch': 2.26}                                                                   
{'loss': 6.5351, 'grad_norm': 1.4293321371078491, 'learning_rate': 0.0002, 'epoch': 2.28}
{'eval_loss': 6.533237457275391, 'eval_runtime': 217.3993, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 2.28}                   
{'loss': 6.5286, 'grad_norm': 1.5379154682159424, 'learning_rate': 0.0002, 'epoch': 2.3}                                                                    
{'loss': 6.5303, 'grad_norm': 0.663162112236023, 'learning_rate': 0.0002, 'epoch': 2.32}
{'eval_loss': 6.532265663146973, 'eval_runtime': 217.4974, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 2.32}                   
{'loss': 6.5256, 'grad_norm': 0.9713095426559448, 'learning_rate': 0.0002, 'epoch': 2.34}                                                                   
{'loss': 6.5311, 'grad_norm': 0.8099871277809143, 'learning_rate': 0.0002, 'epoch': 2.36}
{'eval_loss': 6.532486438751221, 'eval_runtime': 217.5958, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 2.36}                 
{'loss': 6.5299, 'grad_norm': 1.3413586616516113, 'learning_rate': 0.0002, 'epoch': 2.38}                                                                   
{'loss': 6.5275, 'grad_norm': 0.82642662525177, 'learning_rate': 0.0002, 'epoch': 2.4}
{'eval_loss': 6.531784534454346, 'eval_runtime': 217.2396, 'eval_samples_per_second': 0.921, 'eval_steps_per_second': 0.921, 'epoch': 2.4}                  
{'loss': 6.5252, 'grad_norm': 1.1090617179870605, 'learning_rate': 0.0002, 'epoch': 2.42}                                                                   
{'loss': 6.5282, 'grad_norm': 1.11593759059906, 'learning_rate': 0.0002, 'epoch': 2.44}
{'eval_loss': 6.5317606925964355, 'eval_runtime': 216.8671, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 2.44}                
{'loss': 6.5291, 'grad_norm': 1.130672812461853, 'learning_rate': 0.0002, 'epoch': 2.47}                                                                    
{'loss': 6.5307, 'grad_norm': 0.7365561127662659, 'learning_rate': 0.0002, 'epoch': 2.49}
{'eval_loss': 6.532050609588623, 'eval_runtime': 217.5747, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 2.49}                 
{'loss': 6.5351, 'grad_norm': 0.7338492274284363, 'learning_rate': 0.0002, 'epoch': 2.51}                                                                   
{'loss': 6.532, 'grad_norm': 1.5010712146759033, 'learning_rate': 0.0002, 'epoch': 2.53}
{'eval_loss': 6.531328201293945, 'eval_runtime': 217.4211, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 2.53}                   
{'loss': 6.5313, 'grad_norm': 0.6248738765716553, 'learning_rate': 0.0002, 'epoch': 2.55}                                                                   
{'loss': 6.5279, 'grad_norm': 1.0312798023223877, 'learning_rate': 0.0002, 'epoch': 2.57}
{'eval_loss': 6.530960559844971, 'eval_runtime': 217.5717, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 2.57}                 
{'loss': 6.5272, 'grad_norm': 1.133689045906067, 'learning_rate': 0.0002, 'epoch': 2.59}                                                                    
{'loss': 6.5266, 'grad_norm': 0.9953656792640686, 'learning_rate': 0.0002, 'epoch': 2.61}    
{'eval_loss': 6.530604362487793, 'eval_runtime': 217.5898, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 2.61}                                               
{'loss': 6.5298, 'grad_norm': 0.8895167708396912, 'learning_rate': 0.0002, 'epoch': 2.63}    
{'loss': 6.5238, 'grad_norm': 1.3413070440292358, 'learning_rate': 0.0002, 'epoch': 2.66}    
{'eval_loss': 6.530261039733887, 'eval_runtime': 217.2515, 'eval_samples_per_second': 0.921, 'eval_steps_per_second': 0.921, 'epoch': 2.66}                                               
{'loss': 6.5277, 'grad_norm': 0.719389021396637, 'learning_rate': 0.0002, 'epoch': 2.68}     
{'loss': 6.524, 'grad_norm': 1.0999243259429932, 'learning_rate': 0.0002, 'epoch': 2.7}      
{'eval_loss': 6.530245780944824, 'eval_runtime': 217.4823, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 2.7}                                                  
{'loss': 6.5324, 'grad_norm': 0.9612635970115662, 'learning_rate': 0.0002, 'epoch': 2.72}    
{'loss': 6.5314, 'grad_norm': 1.260728359222412, 'learning_rate': 0.0002, 'epoch': 2.74}     
{'eval_loss': 6.530467510223389, 'eval_runtime': 217.6215, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 2.74}                                               
{'loss': 6.526, 'grad_norm': 0.8748852014541626, 'learning_rate': 0.0002, 'epoch': 2.76}     
{'loss': 6.5269, 'grad_norm': 0.7283299565315247, 'learning_rate': 0.0002, 'epoch': 2.78}    
{'eval_loss': 6.529399394989014, 'eval_runtime': 217.7479, 'eval_samples_per_second': 0.918, 'eval_steps_per_second': 0.918, 'epoch': 2.78}                                               
{'loss': 6.5283, 'grad_norm': 1.1132663488388062, 'learning_rate': 0.0002, 'epoch': 2.8}     
{'loss': 6.5268, 'grad_norm': 1.1551218032836914, 'learning_rate': 0.0002, 'epoch': 2.82}    
{'eval_loss': 6.529361724853516, 'eval_runtime': 217.632, 'eval_samples_per_second': 0.919, 'eval_steps_per_second': 0.919, 'epoch': 2.82}                                                
{'loss': 6.5268, 'grad_norm': 0.7027749419212341, 'learning_rate': 0.0002, 'epoch': 2.85}    
{'loss': 6.5274, 'grad_norm': 0.8180713653564453, 'learning_rate': 0.0002, 'epoch': 2.87}    
{'eval_loss': 6.5292649269104, 'eval_runtime': 217.9927, 'eval_samples_per_second': 0.917, 'eval_steps_per_second': 0.917, 'epoch': 2.87}                                                 
{'loss': 6.5312, 'grad_norm': 1.0311928987503052, 'learning_rate': 0.0002, 'epoch': 2.89}    
{'loss': 6.5255, 'grad_norm': 0.7630473375320435, 'learning_rate': 0.0002, 'epoch': 2.91}    
{'eval_loss': 6.528496265411377, 'eval_runtime': 217.4717, 'eval_samples_per_second': 0.92, 'eval_steps_per_second': 0.92, 'epoch': 2.91}                                                 
{'loss': 6.5274, 'grad_norm': 0.851813554763794, 'learning_rate': 0.0002, 'epoch': 2.93}     
{'loss': 6.5287, 'grad_norm': 0.6172767877578735, 'learning_rate': 0.0002, 'epoch': 2.95}    
{'eval_loss': 6.528192043304443, 'eval_runtime': 216.9812, 'eval_samples_per_second': 0.922, 'eval_steps_per_second': 0.922, 'epoch': 2.95}                                               
{'loss': 6.5283, 'grad_norm': 1.0193049907684326, 'learning_rate': 0.0002, 'epoch': 2.97}    
{'loss': 6.5277, 'grad_norm': 1.0454150438308716, 'learning_rate': 0.0002, 'epoch': 2.99}    
{'eval_loss': 6.527688980102539, 'eval_runtime': 218.3081, 'eval_samples_per_second': 0.916, 'eval_steps_per_second': 0.916, 'epoch': 2.99}                                                 
{'train_runtime': 31666.0133, 'train_samples_per_second': 0.36, 'train_steps_per_second': 0.045, 'train_loss': 6.673980739716907, 'epoch': 3.0}                                             
100%|███████████████████████████████████████████████████| 1422/1422 [8:47:46<00:00, 22.27s/it]
Saving model to qwen2-7b-instruct-trl-sft-ADMIRE...
DONE!

Let's analyze the training run with Sonnet:
Training Progress:
Started with high loss (~14.5) and quickly dropped to ~6.5 in the first epoch
Stabilized around 6.52-6.54 for most of training
Final training loss: 6.67
Final eval loss: 6.527
Training took about 8 hours and 47 minutes
The loss reduction and stabilization pattern suggests the model was learning, but the relatively small improvement in later epochs might indicate we could have used a lower learning rate or fewer epochs. However, this kind of plateau is not unusual for large language models, especially when fine-tuning with LoRA.
Warnings to Note:
There was a warning about max_seq_length not being set (defaulting to 1024)
A warning about padding_side not being "right" which could affect training stability
These aren't critical but might be worth addressing in future runs
Regarding HuggingFace Upload:
Only the LoRA adapters were saved and pushed to HuggingFace, not the full model. This is because:
You used PEFT/LoRA configuration
The base model (Qwen2-VL-7B) is too large (~7B parameters)
The LoRA adapters contain just the trained differences from the base model
To use the fine-tuned model, someone would need to:
Load the base Qwen2-VL-7B model
Load your LoRA adapters from HuggingFace
Merge them (or use them in inference mode without merging)
The adapters are much smaller (your trainable params were only 0.0304% of the full model, or about 2.5M parameters), making them easy to share and version control.
Would you like me to suggest any improvements for future training runs based on these results


Great, now let's evaluate it on the test set, versus the base quantized model:
Using UCSC-Admire/Qwen2-VL-7B-Instruct-finetune-2024-12-04_02-08-26

(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$  cd /home/sam/code/ucsc/243/admire/admire-finetuning-sam ; /usr/bin/env /home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/bin/python /home/sam/.cursor/extensions/ms-python.debugpy-2024.6.0-linux-x64/bundled/libs/debugpy/adapter/../../debugpy/launcher 52523 -- /home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/evaluation.py 
Loading test dataset...
Test dataset size: 444
Loading base model...
`Qwen2VLRotaryEmbedding` can now be fully parameterized by passing the model config through the `config` argument. All other arguments will be removed in v4.46
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:02<00:00,  2.08it/s]
Loading finetuned model...
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:02<00:00,  1.98it/s]

Evaluating base model...
Evaluating base model: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 444/444 [11:12<00:00,  1.52s/it]

Evaluating finetuned model...
Evaluating finetuned model: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 444/444 [11:52<00:00,  1.61s/it]

Evaluation Results:
==================================================
Base Model:
Top-1 Accuracy: 0.2050
Spearman Correlation: -0.0239
--------------------------------------------------
Finetuned Model:
Top-1 Accuracy: 0.2252
Spearman Correlation: 0.0588
==================================================


Note that this training run seemed to use about 15GB of GPU memory.

-----------
Okay, I'm curious if I was overfitting at all.
Let's see what we might want to change
-----------

Based on your training results and evaluation metrics, here are several suggestions to potentially improve the model's performance:
Learning Rate Schedule:
training_args = SFTConfig(
    # ... existing args ...
    learning_rate=2e-4,  # Try reducing to 1e-4 or 5e-5
    lr_scheduler_type="cosine_with_restarts",  # Change from "constant"
    num_train_epochs=5,  # Increase epochs since we're using a better scheduler
    warmup_ratio=0.1,  # Increase from 0.03 for more stable initial training
)
Gradient Accumulation and Batch Size:
training_args = SFTConfig(
    # ... existing args ...
    per_device_train_batch_size=1,
    gradient_accumulation_steps=16,  # Increase from 8 for more stable updates
    max_grad_norm=1.0,  # Increase from 0.3 for less aggressive clipping
)
LoRA Configuration:
peft_config = LoraConfig(
    r=32,  # Increase from 16 for more capacity
    lora_alpha=32,  # Keep alpha = r
    target_modules=["q_proj", "v_proj", "k_proj", "o_proj", "gate_proj", "up_proj", "down_proj"],  # Be more specific about which layers to tune
    bias="none",
    task_type="CAUSAL_LM"
)
Data Processing:
def format_data(sample: dict) -> list[dict]:
    """Enhanced data formatting"""
    images = [sample[f"image_{i}"].resize((512, 512)) for i in range(1, 6)]  # Increase resolution
    
    # Add more context to the instruction
    instruction = f"""You are a helpful assistant that can rank images based on their relevance to a given compound and sentence.
    The compound is: {sample['compound']}
    The sentence using this compound is: {sample['sentence']}
    
    Please rank the five images (labeled A through E) from most to least relevant, considering whether the compound is used literally or idiomatically in the sentence.
    
    Respond with only the ranking in the format: X, Y, Z, W, V where these are the image labels in order from most to least relevant.
    """
    
    # Rest of the function remains the same
Training Stability:
training_args = SFTConfig(
    # ... existing args ...
    fp16=False,  # Disable mixed precision if you see NaN losses
    bf16=True,  # Use bfloat16 instead for better numerical stability
    gradient_checkpointing=True,
    optim="adamw_8bit",
    weight_decay=0.05,  # Increase from 0.01 for better regularization
)
The rationale for these changes:
Your loss plateaued quickly (around 6.5) and stayed there, suggesting the learning rate might be too high or the schedule too simple
The modest improvement in accuracy (20.5% → 22.5%) suggests the model might benefit from more capacity (higher LoRA rank) and more stable training
The Spearman correlation improvement (-.024 → .059) shows the model is learning but could benefit from better regularization and training stability
More explicit instructions and higher resolution images might help the model better understand the task
Would you like me to elaborate on any of these suggestions?

~~~

I'm not going to implement all of these. I'll post what I'm running with for a second run

Okay, running with

from datetime import datetime
import random
import PIL
from dotenv import load_dotenv
import os
import torch
from tqdm import tqdm
from transformers import Qwen2VLForConditionalGeneration, Qwen2VLProcessor, BitsAndBytesConfig
from datasets import load_dataset
from peft import LoraConfig, get_peft_model
from trl import SFTConfig, SFTTrainer
import wandb
from qwen_vl_utils import process_vision_info


"""
Attempting to follow tutorials:
HuggingFace: https://huggingface.co/learn/cookbook/en/fine_tuning_vlm_trl
Phil Schmid: https://www.philschmid.de/fine-tune-multimodal-llms-with-trl
"""

load_dotenv()
if os.getenv("HUGGINGFACE_TOKEN") is None:
    raise ValueError("HUGGINGFACE_TOKEN is not set")
hf_token = os.environ["HUGGINGFACE_TOKEN"]

MODEL_ORG_NAME = "Qwen"
MODEL_NAME = "Qwen2-VL-7B-Instruct"
DATASET_NAME = "UCSC-Admire/idiom-dataset-561-2024-12-02_11-48-08" 

RANDOM_SEED = 42
random.seed(RANDOM_SEED)
torch.manual_seed(RANDOM_SEED)
torch.cuda.manual_seed_all(RANDOM_SEED)

processor = None  # Have to make this a global so that collate_fn can access it; wouldn't be a problem in the notebook.


def _create_instruction(row: dict) -> str:
    """
    Returns the user instruction for the model
    """
    return f"""You are given a compound, its use in a sentence (which determines whether a compound should be interpreted literally or idiomatically), and five images.
    The images have respectively been given aliases of A, B, C, D, E.
    Rank the images from most to least relevant, based on how well they represent the compound (in either a literal or idiomatic sense, based on how it's used in the sentence).
    Return the ranking of the images as a comma-separated list of the aliases, from most to least relevant.
    
    As an example, if your predicted ranking from most to least relevant is B, C, A, E, D, then you should respond with "B, C, A, E, D".
    
    <compound>
    {row["compound"]}
    </compound>
    <sentence>
    {row["sentence"]}
    </sentence>

    Given your understanding of the compound and its correct interpretation given its use in the sentence, generate the appropriate ranking of these images.
    """

def _get_shuffled_images_with_ordering(images: list[PIL.Image]) -> tuple[list[PIL.Image], str]:
    """
    Receives images ordered by relevancy, shuffles them, and returns the shuffled images, 
    as well as the correct ordering of aliases to maintain the true relevancy order.
    CONFIRMED: This is working as intended (Dec 3, 11:21PM @Sam)
    # TODO: NOTE THAT I'M NOT CURRENTLY DOING ANY IMAGE RESIZING
    """
    # Numbered images
    numbered_images = [(i, images[i-1]) for i in range(1,6)]
    
    # Create a shuffled version of this list
    shuffled_images = numbered_images.copy()
    random.shuffle(shuffled_images)
    
    # Assign letters A-E to the shuffled images
    letters = list("ABCDE")
    images_with_letters = [
        (letter, image)
        for letter, (_, image) in zip(letters, shuffled_images)
    ]
    
    # Create mapping of original_position to assigned letter
    original_to_letter = {
        orig_pos: letter
        for (orig_pos, _), (letter, _) in zip(shuffled_images, images_with_letters)
    }

    # Now the correct order is the letters assigned to positions 1,2,3,4,5
    correct_order = [original_to_letter[i] for i in range(1, 6)]

    # Just remove the numbers from the shuffled images
    final_shuffled_images = [img for _, img in shuffled_images]
    correct_order_string = ", ".join(correct_order)

    return final_shuffled_images, correct_order_string


def format_data(sample: dict) -> list[dict]:
    """
    analgous to format_data in HFQwenTut: https://huggingface.co/learn/cookbook/en/fine_tuning_vlm_trl
    Takes a row from the original dataset and formats it into the chatbot structure
    Has to return a dict because dataset.map requires a function that returns a dict.
    """
    # NOTE: Added this option to resize before going to bed
    images = [sample[f"image_{i}"].resize((384, 384)) for i in range(1, 6)]
    # images = [sample[f"image_{i}"] for i in range(1, 6)]

    shuffled_images, correct_order = _get_shuffled_images_with_ordering(images)
    instruction = _create_instruction(sample)

    # Return a single dictionary representing the conversation
    return [
        {
            "role": "system",
            "content": [{"type": "text", "text": "You are a helpful assistant that can rank images based on their relevance to a given compound and sentence."}]
        },
        {
            "role": "user",
            "content": [
                *[{"type": "image", "image": img} for img in shuffled_images],
                {"type": "text", "text": instruction}
            ]
        },
        {
            "role": "assistant",
            "content": [{"type": "text", "text": correct_order}]
        }
    ]

def generate_text_from_sample(model, processor, sample, max_new_tokens=64, device="cuda"):
    """
    From the HF Qwen tutorial: https://huggingface.co/learn/cookbook/en/fine_tuning_vlm_trl
    It seems that the samples that are put through here are samples that have already gone through format_data
    IE they're already structured as a conversation.

    NOTE: While the tutorial uses process_vision_info, Sonnet has convinced me that I don't have to.
    In the tutorial, they use process_visoin_info where they're working with a specific dataset format
    where imagse are stored in aprticular way (eg as paths or as encoded data needing preprocessing).
    In contrast, I'm working with PIL Image objects directly, which the Qwen2VL processor cna handle directly.
    The processor knows how to: Resize images, convert them to tensors, handle multiple images in a batch, apply any normalization.
    """
    # Include the full conversation including system message
    text_input = processor.apply_chat_template(
        sample, tokenize=False, add_generation_prompt=True
    )

    # Extract all five images from the user turn's content
    images = []
    for content in sample[1]["content"]:
        if content.get("type") == "image":
            images.append(content["image"])

    # Prepare the inputs for the model
    model_inputs = processor(
        text=[text_input],
        images=images,
        return_tensors="pt",
    ).to(device)

    # Generate text with the model
    generated_ids = model.generate(**model_inputs, max_new_tokens=max_new_tokens)

    # Trim the generated ids to remove the input ids
    trimmed_generated_ids = [
        out_ids[len(in_ids):] 
        for in_ids, out_ids in zip(model_inputs.input_ids, generated_ids)
    ]

    # Decode the output text
    output_text = processor.batch_decode(
        trimmed_generated_ids, 
        skip_special_tokens=True, 
        clean_up_tokenization_spaces=False
    )

    return output_text[0]

def collate_fn(examples: list[dict]) -> dict:  # TODO: IS RETURN TYPE RIGHT?
    """
    Collate function to properly retrieve and batch the data during the training procedure
    Handles formatting of our dataset inputs, ensuring they're correctly structured for model
    
    Used to preprocess both training and evaluation batches, and the length of the list is determined
    by the respecitve batch size:
        -  For training: per_device_train_batch_size (1)
        -  For evaluation: per_device_eval_batch_size (1)
    Each element in the list is a list of dicts as returned from format_data
    """
    global processor
    if processor is None:
        raise ValueError("Processor is not set")

    # Since we're getting a list of conversations, we need to process each one
    formatted_texts = []
    all_images = []
    
    for conversation in examples:  # Usually just one conversation due to batch_size=1
        # Apply chat template to format the conversation
        text = processor.apply_chat_template(conversation, tokenize=False)
        formatted_texts.append(text)
        
        # Extract images from the user turn
        user_turn = [turn for turn in conversation if turn["role"] == "user"][0]
        images = [content["image"] for content in user_turn["content"] 
                 if content["type"] == "image"]
        all_images.extend(images)
    
    # Process both text and images together
    batch = processor(
        text=formatted_texts,
        images=all_images,
        return_tensors="pt",
        padding=True
    )
    
    # Create labels for training (same as input_ids but with padding masked)
    # TODO(SAM): CHECK THIS FUNCTION, IS THIS RIGHT? SEE TUTORIALS
    labels = batch["input_ids"].clone()
    labels[labels == processor.tokenizer.pad_token_id] = -100
    batch["labels"] = labels
    
    return batch

def main():
    # Load training dataset
    print("Loading dataset...")
    dataset = load_dataset(DATASET_NAME, split="train")
    print(f"Dataset size: {len(dataset)}")
    dataset_dict = dataset.train_test_split(test_size=0.05, seed=42) # Use 5% of the training split as evaluation
    print("Processing datasets...")
    # train_dataset = dataset_dict["train"].map(
    #     format_data,
    #     batched=False,
    #     # batch_size=32,
    #     num_proc=1,
    #     remove_columns=dataset_dict["train"].column_names,
    #     load_from_cache_file=False,  # Disable caching
    #     keep_in_memory=False # Not sure what this does yet, but o1 thinks it exists and matters?
    # )
    # print(f"Mapped training data")
    # eval_dataset = dataset_dict["test"].map(
    #     format_data,
    #     batched=False,
    #     # batch_size=32,
    #     num_proc=1,
    #     remove_columns=dataset_dict["test"].column_names,
    #     load_from_cache_file=False,  # Disable caching
    #     keep_in_memory=False # Not sure what this does yet, but o1 thinks it exists and matters?
    # )
    # print(f"Mapped evaluation data")
    # print(f"Train dataset size: {len(train_dataset)}")
    # print(f"Eval dataset size: {len(eval_dataset)}")

    # Process the datasets
    # print("Processing datasets...")
    train_dataset = dataset_dict["train"]
    test_dataset = dataset_dict["test"]
    train_dataset = [format_data(sample) for sample in tqdm(train_dataset, desc="Processing train data")]
    eval_dataset = [format_data(sample) for sample in tqdm(test_dataset, desc="Processing eval data")]

    # Create Bits and Bytes Config
    # The model's weights are quantized to 4-bit, but the computations (activations, gradients) are done in bfloat16 for better numerical stability. 
    # This combination gives you both memory efficiency (from 4-bit quantization) and training stability (from bfloat16 compute).
    bnb_config = BitsAndBytesConfig(
        load_in_4bit=True, bnb_4bit_use_double_quant=True, bnb_4bit_quant_type="nf4", bnb_4bit_compute_dtype=torch.bfloat16
    )
    # Load the model
    print("Loading model...")
    model = Qwen2VLForConditionalGeneration.from_pretrained(
        pretrained_model_name_or_path=f"{MODEL_ORG_NAME}/{MODEL_NAME}",
        device_map="auto",
        torch_dtype=torch.bfloat16,
        quantization_config=bnb_config,
    )
    print("Loading processor...")
    global processor
    processor = Qwen2VLProcessor.from_pretrained(
        f"{MODEL_ORG_NAME}/{MODEL_NAME}",
        min_pixels=256*28*28,  # Minimum number of pixels (256 tokens)
        max_pixels=384*28*28   # Maximum number of pixels (384 tokens instead of 1024 for memory savings)
    )

    # Configure QLoRA (Unlike standard LoRA, which reduces memory by applying a low-rank approximation,
    # takes it a step further by quantizing the weights of the LoRA adapters, leading to even lower memory requirements)
    peft_config = LoraConfig(
        lora_alpha=32,
        lora_dropout=0.05,
        r=32,
        bias="none",
        target_modules=["q_proj", "v_proj", "k_proj", "o_proj", "gate_proj", "up_proj", "down_proj"],
        task_type="CAUSAL_LM"
    )

    # Apply PEFT model adaptation
    peft_model = get_peft_model(model, peft_config)

    # Print the trainable parameters
    peft_model.print_trainable_parameters()

    # Configure training arguments
    now = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    training_args = SFTConfig(
        output_dir="qwen2-7b-instruct-trl-sft-ADMIRE",  # Directory to save the model
        num_train_epochs=3,  # Number of training epochs
        per_device_train_batch_size=1,  # Batch size for training
        per_device_eval_batch_size=1,  # Batch size for evaluation
        gradient_accumulation_steps=16,  # Steps to accumulate gradients
        gradient_checkpointing=True,  # Enable gradient checkpointing for memory efficiency
        # Optimizer and scheduler settings
        optim="adamw_8bit",  # Optimizer type
        learning_rate=2e-4,  # Learning rate for training
        lr_scheduler_type="cosine_with_restarts",  # Type of learning rate scheduler
        weight_decay=0.05,
        # Logging and evaluation
        logging_steps=10,  # Steps interval for logging
        eval_steps=40,  # Steps interval for evaluation
        eval_strategy="steps",  # Strategy for evaluation
        save_strategy="steps",  # Strategy for saving the model
        save_steps=200,  # Steps interval for saving
        metric_for_best_model="eval_loss",  # Metric to evaluate the best model
        greater_is_better=False,  # Whether higher metric values are better
        load_best_model_at_end=True,  # Load the best model after training
        # Mixed precision and gradient settings
        bf16=True,  # Use bfloat16 precision
        tf32=True,  # Use TensorFloat-32 precision
        max_grad_norm=1,  # Maximum norm for gradient clipping
        warmup_ratio=0.1,  # Ratio of total steps for warmup
        # Hub and reporting
        push_to_hub=True,  # Whether to push model to Hugging Face Hub
        hub_model_id=f"UCSC-Admire/Qwen2-VL-7B-Instruct-finetune-{now}",
        hub_token=hf_token,
        report_to="wandb",  # Reporting tool for tracking metrics
        # Gradient checkpointing settings
        gradient_checkpointing_kwargs={"use_reentrant": False},  # Options for gradient checkpointing
        # Dataset configuration
        dataset_text_field="",  # Text field in dataset
        dataset_kwargs={"skip_prepare_dataset": True},  # Additional dataset options
        # max_seq_length=1024  # Maximum sequence length for input
    )
    training_args.remove_unused_columns = False  # Keep unused columns in dataset

    # Conecting to weights and biases
    wandb.init(
        project="qwen2-7b-instruct-trl-sft",
        name=f"qwen2-7b-instruct-trl-sft-{now}",
        config=training_args
    )

    # Try generating text from a sample, does it work? Yes!
    sample = train_dataset[0]
    generated_text = generate_text_from_sample(peft_model, processor, sample)
    print(generated_text)

    trainer = SFTTrainer(
        model=peft_model,
        args=training_args,
        train_dataset=train_dataset,
        eval_dataset=eval_dataset,
        data_collator=collate_fn,
        # peft_config=peft_config, # It seems you can either pass the model + peft config or peft_model (Their way in the tutorial isn't obviously supported from the @HFQwen tutorial)
        tokenizer=processor.tokenizer,
    )

    # Train the model!
    print("Training the model...")
    trainer.train()

    print(f"Saving model to {training_args.output_dir}...")
    trainer.save_model(training_args.output_dir)


if __name__ == "__main__":
    main()
    print("DONE!")


TRaining run:

/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/bin/python /home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py
(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$ /home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/bin/python /home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py
Loading dataset...
Dataset size: 3996
Processing datasets...
Processing train data: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 3796/3796 [03:36<00:00, 17.55it/s]
Processing eval data: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 200/200 [00:11<00:00, 17.32it/s]
Loading model...
`Qwen2VLRotaryEmbedding` can now be fully parameterized by passing the model config through the `config` argument. All other arguments will be removed in v4.46
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:02<00:00,  1.96it/s]
Loading processor...
trainable params: 80,740,352 || all params: 8,372,115,968 || trainable%: 0.9644
Traceback (most recent call last):
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py", line 372, in <module>
    main()
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py", line 301, in main
    training_args = SFTConfig(
                    ^^^^^^^^^^
  File "<string>", line 145, in __init__
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/training_args.py", line 1655, in __post_init__
    raise ValueError(
ValueError: --load_best_model_at_end requires the saving steps to be a round multiple of the evaluation steps, but found 20, which is not a round multiple of 40.
(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$ /home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/bin/python /home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py
Loading dataset...
Dataset size: 3996
Processing datasets...
Processing train data:   2%|██▍                                                         Processing train data:   2%|██▍                                                         Processing train data:   2%|██▍                                                         Processing train data:   2%|██▌                                                         Processing train data:   2%|██▌                                                         Processing train data:   2%|██▋                                                         Processing train data:   3%|██▋                                                         Processing train data:   3%|██▊                                                         Processing train data:   3%|██▊                                                         Processing train data:   3%|██▊                                                         Processing train data:   3%|██▉                                                         Processing train data:   3%|██▉                                                         Processing train data:   3%|███                                                         Processing train data:   3%|███                                                         Processing train data:   3%|███▏                                                        Processing train data:   3%|███▏                                                        Processing train data:   3%|███▎                                                        Processing train data:   3%|███▎                                                        Processing train data:   3%|███▍                                                        Processing train data:   3%|███▍                                                        Processing train data:   3%|███▍                                                        Processing train data:   3%|███▌                                                        Processing train data:   3%|███▌                                                        Processing train data:   3%|███▋                                                        Processing train data:   3%|███▋                                                        Processing train data:   4%|███▊                                                        Processing train data:   4%|███▊                                                        Processing train data:   4%|███▉                                                        Processing train data:   4%|███▉                                                        Processing train data:   4%|████                                                        Processing train data:   4%|████                                                        Processing train data:   4%|████▏                                                       Processing train data:   4%|████▏                                                       Processing train data:   4%|████▏                                                       Processing train data:   4%|████▎                                                       Processing train data:   4%|████▎                                                       Processing train data:   4%|████▍                                                       Processing train data:   4%|████▍                                                       Processing train data:   4%|████▌                                                       Processing train data:   4%|████▌                                                       Processing train data:   4%|████▋                                                       Processing train data:   4%|████▋                                                       Processing train data:   4%|████▊                                                       Processing train data:   4%|████▊                                                       Processing train data:   5%|████▊                                                       Processing train data:   5%|████▉                                                       Processing train data:   5%|████▉                                                       Processing train data:   5%|█████                                                       Processing train data:   5%|█████                                                       Processing train data:   5%|█████▏                                                      Processing train data:   5%|█████▏                                                      Processing train data:   5%|█████▎                                                      Processing train data:   5%|█████▎                                                      Processing train data:   5%|█████▍                                                      Processing train data:   5%|█████▍                                                      Processing train data:   5%|█████▍                                                      Processing train data:   5%|█████▌                                                      Processing train data:   5%|█████▌                                                      Processing train data:   5%|█████▋                                                      Processing train data:   5%|█████▋                                                      Processing train data:   5%|█████▊                                                      Processing train data:   5%|█████▊                                                      Processing train data:   5%|█████▉                                                      Processing train data:   6%|█████▉                                                      Processing train data:   6%|██████                                                      Processing train data:   6%|██████                                                      Processing train data:   6%|██████                                                      Processing train data:   6%|██████▏                                                     Processing train data:   6%|██████▏                                                     Processing train data:   6%|██████▎                                                     Processing train data:   6%|██████▎                                                     Processing train data:   6%|██████▍                                                     Processing train data:   6%|██████▍                                                     Processing train data:   6%|██████▌                                                     Processing train data:   6%|██████▌                                                     Processing train data:   6%|██████▋                                                     Processing train data:   6%|██████▋                                                     Processing train data:   6%|██████▋                                                     Processing train data:   6%|██████▊                                                     Processing train data:   6%|██████▊                                                     Processing train data:   6%|██████▉                                                     Processing train data:   6%|██████▉                                                     Processing train data:   7%|███████                                                     Processing train data:   7%|███████                                                     Processing train data:   7%|███████▏                                                    Processing train data:   7%|███████▏                                                    Processing train data:   7%|███████▎                                                    Processing train data:   7%|███████▎                                                    Processing train data:   7%|███████▎                                                    Processing train data:   7%|███████▍                                                    Processing train data:   7%|███████▍                                                    Processing train data:   7%|███████▌                                                    Processing train data:   7%|███████▌                                                    Processing train data:   7%|███████▋                                                    Processing train data:   7%|███████▋                                                    Processing train data:   7%|███████▊                                                    Processing train data:   7%|███████▊                                                    Processing train data:   7%|███████▉                                                    Processing train data:   7%|███████▉                                                    Processing train data:   7%|███████▉                                                    Processing train data:   7%|████████                                                    Processing train data:   8%|████████                                                    Processing train data:   8%|████████▏                                                   Processing train data:   8%|████████▏                                                   Processing train data:   8%|████████▎                                                   Processing train data:   8%|████████▎                                                   Processing train data:   8%|████████▍                                                   Processing train data:   8%|████████▍                                                   Processing train data:   8%|████████▌                                                   Processing train data:   8%|████████▌                                                   Processing train data:   8%|████████▌                                                   Processing train data:   8%|████████▋                                                   Processing train data:   8%|████████▋                                                   Processing train data:   8%|████████▊                                                   Processing train data:   8%|████████▊                                                   Processing train data:   8%|████████▉                                                   Processing train data:   8%|████████▉                                                   Processing train data:   8%|█████████                                                   Processing train data:   8%|█████████                                                   Processing train data:   8%|█████████▏                                                  Processing train data:   9%|█████████▏                                                  Processing train data:   9%|█████████▎                                                  Processing train data:   9%|█████████▎                                                  Processing train data:   9%|█████████▍                                                  Processing train data:   9%|█████████▍                                                  Processing train data:   9%|█████████▌                                                  Processing train data:   9%|█████████▌                                                  Processing train data:   9%|█████████▌                                                  Processing train data:   9%|█████████▋                                                  Processing train data:   9%|█████████▋                                                  Processing train data:   9%|█████████▊                                                  Processing train data:   9%|█████████▊                                                  Processing train data:   9%|█████████▉                                                  Processing train data:   9%|█████████▉                                                  Processing train data:   9%|██████████                                                  Processing train data:   9%|██████████                                                  Processing train data:   9%|██████████▏                                                 Processing train data:   9%|██████████▏                                                 Processing train data:   9%|██████████▏                                                 Processing train data:  10%|██████████▎                                                 Processing train data:  10%|██████████▎                                                 Processing train data:  10%|██████████▍                                                 Processing train data:  10%|██████████▍                                                 Processing train data:  10%|██████████▌                                                 Processing train data:  10%|██████████▌                                                 Processing train data:  10%|██████████▋                                                 Processing train data:  10%|██████████▋                                                 Processing train data:  10%|██████████▊                                                 Processing train data:  10%|██████████▊                                                 Processing train data:  10%|██████████▊                                                 Processing train data:  10%|██████████▉                                                 Processing train data:  10%|██████████▉                                                 Processing train data:  10%|███████████                                                 Processing train data:  10%|███████████                                                 Processing train data:  10%|███████████▏                                                Processing train data:  10%|███████████▏                                                Processing train data:  10%|███████████▎                                                Processing train data:  10%|███████████▎                                                Processing train data:  11%|███████████▍                                                Processing train data:  11%|███████████▍                                                Processing train data:  11%|███████████▍                                                Processing train data:  11%|███████████▌                                                Processing train data:  11%|███████████▌                                                Processing train data:  11%|███████████▋                                                Processing train data:  11%|███████████▋                                                Processing train data:  11%|███████████▊                                                Processing train data:  11%|███████████▊                                                Processing train data:  11%|███████████▉                                                Processing train data:  11%|███████████▉                                                Processing train data:  11%|████████████                                                Processing train data:  11%|████████████                                                Processing train data:  11%|████████████                                                Processing train data:  11%|████████████▏                                               Processing train data:  11%|████████████▏                                               Processing train data:  11%|████████████▎                                               Processing train data:  11%|████████████▎                                               Processing train data:  11%|████████████▍                                               Processing train data:  12%|████████████▍                                               Processing train data:  12%|████████████▌                                               Processing train data:  12%|████████████▌                                               Processing train data:  12%|████████████▋                                               Processing train data:  12%|████████████▋                                               Processing train data:  12%|████████████▋                                               Processing train data:  12%|████████████▊                                               Processing train data:  12%|████████████▊                                               Processing train data:  12%|████████████▉                                               Processing train data:  12%|████████████▉                                               Processing train data:  12%|█████████████                                               Processing train data:  12%|█████████████                                               Processing train data:  12%|█████████████▏                                              Processing train data:  12%|█████████████▏                                              Processing train data:  12%|█████████████▎                                              Processing train data:  12%|█████████████▎                                              Processing train data:  12%|█████████████▎                                              Processing train data:  12%|█████████████▍                                              Processing train data:  12%|█████████████▍                                              Processing train data:  13%|█████████████▌                                              Processing train data:  13%|█████████████▌                                              Processing train data:  13%|█████████████▋                                              Processing train data:  13%|█████████████▋                                              Processing train data:  13%|█████████████▊                                              Processing train data:  13%|█████████████▊                                              Processing train data:  13%|█████████████▉                                              Processing train data:  13%|█████████████▉                                              Processing train data:  13%|█████████████▉                                              Processing train data:  13%|██████████████                                              Processing train data:  13%|██████████████                                              Processing train data:  13%|██████████████▏                                             Processing train data:  13%|██████████████▏                                             Processing train data:  13%|██████████████▎                                             Processing train data:  13%|██████████████▎                                             Processing train data:  13%|██████████████▍                                             Processing train data:  13%|██████████████▍                                             Processing train data:  13%|██████████████▌                                             Processing train data:  13%|██████████████▌                                             Processing train data:  14%|██████████████▌                                             Processing train data:  14%|██████████████▋                                             Processing train data:  14%|██████████████▋                                             Processing train data:  14%|██████████████▊                                             Processing train data:  14%|██████████████▊                                             Processing train data:  14%|██████████████▉                                             Processing train data:  14%|██████████████▉                                             Processing train data:  14%|███████████████                                             Processing train data:  14%|███████████████                                             Processing train data:  14%|███████████████▏                                            Processing train data:  14%|███████████████▏                                            Processing train data:  14%|███████████████▏                                            Processing train data:  14%|███████████████▎                                            Processing train data:  14%|███████████████▎                                            Processing train data:  14%|███████████████▍                                            Processing train data:  14%|███████████████▍                                            Processing train data:  14%|███████████████▌                                            Processing train data:  14%|███████████████▌                                            Processing train data:  14%|███████████████▋                                            Processing train data:  15%|███████████████▋                                            Processing train data:  15%|███████████████▊                                            Processing train data:  15%|███████████████▊                                            Processing train data:  15%|███████████████▉                                            Processing train data:  15%|███████████████▉                                            Processing train data:  15%|███████████████▉                                            Processing train data:  15%|████████████████                                            Processing train data:  15%|████████████████                                            Processing train data:  15%|████████████████▏                                           Processing train data:  15%|████████████████▏                                           Processing train data:  15%|████████████████▎                                           Processing train data:  15%|████████████████▎                                           Processing train data:  15%|████████████████▍                                           Processing train data:  15%|████████████████▍                                           Processing train data:  15%|████████████████▌                                           Processing train data:  15%|████████████████▌                                           Processing train data:  15%|████████████████▌                                           Processing train data:  15%|████████████████▋                                           Processing train data:  15%|████████████████▋                                           Processing train data:  16%|████████████████▊                                           Processing train data:  16%|████████████████▊                                           Processing train data:  16%|████████████████▉                                           Processing train data:  16%|████████████████▉                                           Processing train data:  16%|█████████████████                                           Processing train data:  16%|█████████████████                                           Processing train data:  16%|█████████████████▏                                          Processing train data:  16%|█████████████████▏                                          Processing train data:  16%|█████████████████▏                                          Processing train data:  16%|█████████████████▎                                          Processing train data:  16%|█████████████████▎                                          Processing train data:  16%|█████████████████▍                                          Processing train data:  16%|█████████████████▍                                          Processing train data:  16%|█████████████████▌                                          Processing train data:  16%|█████████████████▌                                          Processing train data:  16%|█████████████████▋                                          Processing train data:  16%|█████████████████▋                                          Processing train data:  16%|█████████████████▊                                          Processing train data:  17%|█████████████████▊                                          Processing train data:  17%|█████████████████▉                                          Processing train data:  17%|█████████████████▉                                          Processing train data:  17%|██████████████████                                          Processing train data:  17%|██████████████████                                          Processing train data:  17%|██████████████████                                          Processing train data:  17%|██████████████████▏                                         Processing train data:  17%|██████████████████▏                                         Processing train data:  17%|██████████████████▎                                         Processing train data:  17%|██████████████████▎                                         Processing train data:  17%|██████████████████▍                                         Processing train data:  17%|██████████████████▍                                         Processing train data:  17%|██████████████████▌                                         Processing train data:  17%|██████████████████▌                                         Processing train data:  17%|██████████████████▋                                         Processing train data:  17%|██████████████████▋                                         Processing train data:  17%|██████████████████▋                                         Processing train data:  17%|██████████████████▊                                         Processing train data:  17%|██████████████████▊                                         Processing train data:  18%|██████████████████▉                                         Processing train data:  18%|██████████████████▉                                         Processing train data:  18%|███████████████████                                         Processing train data:  18%|███████████████████                                         Processing train data:  18%|███████████████████▏                                        Processing train data:  18%|███████████████████▏                                        Processing train data:  18%|███████████████████▎                                        Processing train data:  18%|███████████████████▎                                        Processing train data:  18%|███████████████████▍                                        Processing train data:  18%|███████████████████▍                                        Processing train data:  18%|███████████████████▍                                        Processing train data:  18%|███████████████████▌                                        Processing train data:  18%|███████████████████▌                                        Processing train data:  18%|███████████████████▋                                        Processing train data:  18%|███████████████████▋                                        Processing train data:  18%|███████████████████▊                                        Processing train data:  18%|███████████████████▊                                        Processing train data:  18%|███████████████████▉                                        Processing train data:  18%|███████████████████▉                                        Processing train data:  19%|████████████████████                                        Processing train data:  19%|████████████████████                                        Processing train data:  19%|████████████████████                                        Processing train data:  19%|████████████████████▏                                       Processing train data:  19%|████████████████████▏                                       Processing train data:  19%|████████████████████▎                                       Processing train data:  19%|████████████████████▎                                       Processing train data:  19%|████████████████████▍                                       Processing train data:  19%|████████████████████▍                                       Processing train data:  19%|████████████████████▌                                       Processing train data:  19%|████████████████████▌                                       Processing train data:  19%|████████████████████▋                                       Processing train data:  19%|████████████████████▋                                       Processing train data:  19%|████████████████████▊                                       Processing train data:  19%|████████████████████▊                                       Processing train data:  19%|████████████████████▉                                       Processing train data:  19%|████████████████████▉                                       Processing train data:  19%|████████████████████▉                                       Processing train data:  19%|█████████████████████                                       Processing train data:  20%|█████████████████████                                       Processing train data:  20%|█████████████████████▏                                      Processing train data:  20%|█████████████████████▏                                      Processing train data:  20%|█████████████████████▎                                      Processing train data:  20%|█████████████████████▎                                      Processing train data:  20%|█████████████████████▍                                      Processing train data:  20%|█████████████████████▍                                      Processing train data:  20%|█████████████████████▌                                      Processing train data:  20%|█████████████████████▌                                      Processing train data:  20%|█████████████████████▌                                      Processing train data:  20%|█████████████████████▋                                      Processing train data:  20%|█████████████████████▋                                      Processing train data:  20%|█████████████████████▊                                      Processing train data:  20%|█████████████████████▊                                      Processing train data:  20%|█████████████████████▉                                      Processing train data:  20%|█████████████████████▉                                      Processing train data:  20%|██████████████████████                                      Processing train data:  20%|██████████████████████                                      Processing train data:  21%|██████████████████████▏                                     Processing train data:  21%|██████████████████████▏                                     Processing train data:  21%|██████████████████████▎                                     Processing train data:  21%|██████████████████████▎                                     Processing train data:  21%|██████████████████████▍                                     Processing train data:  21%|██████████████████████▍                                     Processing train data:  21%|██████████████████████▌                                     Processing train data:  21%|██████████████████████▌                                     Processing train data:  21%|██████████████████████▌                                     Processing train data:  21%|██████████████████████▋                                     Processing train data:  21%|██████████████████████▋                                     Processing train data:  21%|██████████████████████▊                                     Processing train data:  21%|██████████████████████▊                                     Processing train data:  21%|██████████████████████▉                                     Processing train data:  21%|██████████████████████▉                                     Processing train data:  21%|███████████████████████                                     Processing train data:  21%|███████████████████████                                     Processing train data:  21%|███████████████████████▏                                    Processing train data:  21%|███████████████████████▏                                    Processing train data:  22%|███████████████████████▏                                    Processing train data:  22%|███████████████████████▎                                    Processing train data:  22%|███████████████████████▎                                    Processing train data:  22%|███████████████████████▍                                    Processing train data:  22%|███████████████████████▍                                    Processing train data:  22%|███████████████████████▌                                    Processing train data:  22%|███████████████████████▌                                    Processing train data:  22%|███████████████████████▋                                    Processing train data:  22%|███████████████████████▋                                    Processing train data:  22%|███████████████████████▊                                    Processing train data:  22%|███████████████████████▊                                    Processing train data:  22%|███████████████████████▊                                    Processing train data:  22%|███████████████████████▉                                    Processing train data:  22%|███████████████████████▉                                    Processing train data:  22%|████████████████████████                                    Processing train data:  22%|████████████████████████▏                                   Processing train data:  22%|████████████████████████▏                                   Processing train data:  22%|████████████████████████▏                                   Processing train data:  22%|████████████████████████▎                                   Processing train data:  23%|████████████████████████▎                                   Processing train data:  23%|████████████████████████▍                                   Processing train data:  23%|████████████████████████▍                                   Processing train data:  23%|████████████████████████▌                                   Processing train data:  23%|████████████████████████▌                                   Processing train data:  23%|████████████████████████▋                                   Processing train data:  23%|████████████████████████▋                                   Processing train data:  23%|████████████████████████▊                                   Processing train data:  23%|████████████████████████▊                                   Processing train data:  23%|████████████████████████▉                                   Processing train data:  23%|████████████████████████▉                                   Processing train data:  23%|█████████████████████████                                   Processing train data:  23%|█████████████████████████                                   Processing train data:  23%|█████████████████████████                                   Processing train data:  23%|█████████████████████████▏                                  Processing train data:  23%|█████████████████████████▏                                  Processing train data:  23%|█████████████████████████▎                                  Processing train data:  23%|█████████████████████████▎                                  Processing train data:  24%|█████████████████████████▍                                  Processing train data:  24%|█████████████████████████▍                                  Processing train data:  24%|█████████████████████████▌                                  Processing train data:  24%|█████████████████████████▌                                  Processing train data:  24%|█████████████████████████▋                                  Processing train data:  24%|█████████████████████████▋                                  Processing train data:  24%|█████████████████████████▋                                  Processing train data:  24%|█████████████████████████▊                                  Processing train data:  24%|█████████████████████████▊                                  Processing train data:  24%|█████████████████████████▉                                  Processing train data:  24%|█████████████████████████▉                                  Processing train data:  24%|██████████████████████████                                  Processing train data:  24%|██████████████████████████                                  Processing train data:  24%|██████████████████████████▏                                 Processing train data:  24%|██████████████████████████▏                                 Processing train data:  24%|██████████████████████████▎                                 Processing train data:  24%|██████████████████████████▎                                 Processing train data:  24%|██████████████████████████▍                                 Processing train data:  24%|██████████████████████████▍                                 Processing train data:  25%|██████████████████████████▌                                 Processing train data:  25%|██████████████████████████▌                                 Processing train data:  25%|██████████████████████████▋                                 Processing train data:  25%|██████████████████████████▋                                 Processing train data:  25%|██████████████████████████▊                                 Processing train data:  25%|██████████████████████████▊                                 Processing train data:  25%|██████████████████████████▉                                 Processing train data:  25%|██████████████████████████▉                                 Processing train data:  25%|███████████████████████████                                 Processing train data:  25%|███████████████████████████                                 Processing train data:  25%|███████████████████████████                                 Processing train data:  25%|███████████████████████████▏                                Processing train data:  25%|███████████████████████████▏                                Processing train data:  25%|███████████████████████████▎                                Processing train data:  25%|███████████████████████████▎                                Processing train data:  25%|███████████████████████████▍                                Processing train data:  25%|███████████████████████████▍                                Processing train data:  25%|███████████████████████████▌                                Processing train data:  26%|███████████████████████████▌                                Processing train data:  26%|███████████████████████████▋                                Processing train data:  26%|███████████████████████████▋                                Processing train data:  26%|███████████████████████████▋                                Processing train data:  26%|███████████████████████████▊                                Processing train data:  26%|███████████████████████████▊                                Processing train data:  26%|███████████████████████████▉                                Processing train data:  26%|███████████████████████████▉                                Processing train data:  26%|████████████████████████████                                Processing train data:  26%|████████████████████████████                                Processing train data:  26%|████████████████████████████▏                               Processing train data:  26%|████████████████████████████▏                               Processing train data:  26%|████████████████████████████▎                               Processing train data:  26%|████████████████████████████▎                               Processing train data:  26%|████████████████████████████▎                               Processing train data:  26%|████████████████████████████▍                               Processing train data:  26%|████████████████████████████▏                               Processing train data:  26%|████████████████████████████▎                               Processing train data:  26%|████████████████████████████▎                               Processing train data:  27%|████████████████████████████▍                               Processing train data:  27%|████████████████████████████▍                               Processing train data:  27%|████████████████████████████▍                               Processing train data:  27%|████████████████████████████▌                               Processing train data:  27%|████████████████████████████▌                               Processing train data:  27%|████████████████████████████▋                               Processing train data:  27%|████████████████████████████▋                               Processing train data:  27%|████████████████████████████▊                               Processing train data:  27%|████████████████████████████▊                               Processing train data:  27%|████████████████████████████▉                               Processing train data:  27%|████████████████████████████▉                               Processing train data:  27%|█████████████████████████████                               Processing train data:  27%|█████████████████████████████                               Processing train data:  27%|█████████████████████████████                               Processing train data:  27%|█████████████████████████████▏                              Processing train data:  27%|█████████████████████████████▏                              Processing train data:  27%|█████████████████████████████▎                              Processing train data:  27%|█████████████████████████████▎                              Processing train data:  27%|█████████████████████████████▍                              Processing train data:  28%|█████████████████████████████▍                              Processing train data:  28%|█████████████████████████████▌                              Processing train data:  28%|█████████████████████████████▌                              Processing train data:  28%|█████████████████████████████▋                              Processing train data:  28%|█████████████████████████████▋                              Processing train data:  28%|█████████████████████████████▋                              Processing train data:  28%|█████████████████████████████▊                              Processing train data:  28%|█████████████████████████████▊                              Processing train data:  28%|█████████████████████████████▉                              Processing train data:  28%|█████████████████████████████▉                              Processing train data:  28%|██████████████████████████████                              Processing train data:  28%|██████████████████████████████                              Processing train data:  28%|██████████████████████████████▏                             Processing train data:  28%|██████████████████████████████▏                             Processing train data:  28%|██████████████████████████████▎                             Processing train data:  28%|██████████████████████████████▎                             Processing train data:  28%|██████████████████████████████▍                             Processing train data:  28%|██████████████████████████████▍                             Processing train data:  29%|██████████████████████████████▍                             Processing train data:  29%|██████████████████████████████▌                             Processing train data:  29%|██████████████████████████████▌                             Processing train data:  29%|██████████████████████████████▋                             Processing train data:  29%|██████████████████████████████▋                             Processing train data:  29%|██████████████████████████████▊                             Processing train data:  29%|██████████████████████████████▊                             Processing train data:  29%|██████████████████████████████▉                             Processing train data:  29%|██████████████████████████████▉                             Processing train data:  29%|███████████████████████████████                             Processing train data:  29%|███████████████████████████████                             Processing train data:  29%|███████████████████████████████                             Processing train data:  29%|███████████████████████████████▏                            Processing train data:  29%|███████████████████████████████▎                            Processing train data:  29%|███████████████████████████████▎                            Processing train data:  29%|███████████████████████████████▍                            Processing train data:  29%|███████████████████████████████▍                            Processing train data:  29%|███████████████████████████████▌                            Processing train data:  30%|███████████████████████████████▌                            Processing train data:  30%|███████████████████████████████▋                            Processing train data:  30%|███████████████████████████████▋                            Processing train data:  30%|███████████████████████████████▋                            Processing train data:  30%|███████████████████████████████▊                            Processing train data:  30%|███████████████████████████████▊                            Processing train data:  30%|███████████████████████████████▉                            Processing train data:  30%|███████████████████████████████▉                            Processing train data:  30%|████████████████████████████████                            Processing train data:  30%|████████████████████████████████                            Processing train data:  30%|████████████████████████████████▏                           Processing train data:  30%|████████████████████████████████▏                           Processing train data:  30%|████████████████████████████████▏                           Processing train data:  30%|████████████████████████████████▎                           Processing train data:  30%|████████████████████████████████▎                           Processing train data:  30%|████████████████████████████████▍                           Processing train data:  30%|████████████████████████████████▍                           Processing train data:  30%|████████████████████████████████▌                           Processing train data:  30%|████████████████████████████████▌                           Processing train data:  31%|████████████████████████████████▋                           Processing train data:  31%|████████████████████████████████▋                           Processing train data:  31%|████████████████████████████████▊                           Processing train data:  31%|████████████████████████████████▊                           Processing train data:  31%|████████████████████████████████▊                           Processing train data:  31%|████████████████████████████████▉                           Processing train data:  31%|████████████████████████████████▉                           Processing train data:  31%|█████████████████████████████████                           Processing train data:  31%|█████████████████████████████████                           Processing train data:  31%|█████████████████████████████████▏                          Processing train data:  31%|█████████████████████████████████▏                          Processing train data:  31%|█████████████████████████████████▎                          Processing train data:  31%|█████████████████████████████████▎                          Processing train data:  31%|█████████████████████████████████▎                          Processing train data:  31%|█████████████████████████████████▍                          Processing train data:  31%|█████████████████████████████████▍                          Processing train data:  31%|█████████████████████████████████▌                          Processing train data:  31%|█████████████████████████████████▌                          Processing train data:  31%|█████████████████████████████████▋                          Processing train data:  32%|█████████████████████████████████▋                          Processing train data:  32%|█████████████████████████████████▊                          Processing train data:  32%|█████████████████████████████████▊                          Processing train data:  32%|█████████████████████████████████▉                          Processing train data:  32%|█████████████████████████████████▉                          Processing train data:  32%|█████████████████████████████████▉                          Processing train data:  32%|██████████████████████████████████                          Processing train data:  32%|██████████████████████████████████                          Processing train data:  32%|██████████████████████████████████▏                         Processing train data:  32%|██████████████████████████████████▏                         Processing train data:  32%|██████████████████████████████████▎                         Processing train data:  32%|██████████████████████████████████▎                         Processing train data:  32%|██████████████████████████████████▍                         Processing train data:  32%|██████████████████████████████████▍                         Processing train data:  32%|██████████████████████████████████▌                         Processing train data:  32%|██████████████████████████████████▌                         Processing train data:  32%|██████████████████████████████████▋                         Processing train data:  32%|██████████████████████████████████▋                         Processing train data:  32%|██████████████████████████████████▊                         Processing train data:  33%|██████████████████████████████████▊                         Processing train data:  33%|██████████████████████████████████▊                         Processing train data:  33%|██████████████████████████████████▉                         Processing train data:  33%|██████████████████████████████████▉                         Processing train data:  33%|███████████████████████████████████                         Processing train data:  33%|███████████████████████████████████                         Processing train data:  33%|███████████████████████████████████▏                        Processing train data:  33%|███████████████████████████████████▏                        Processing train data:  33%|███████████████████████████████████▎                        Processing train data:  33%|███████████████████████████████████▎                        Processing train data:  33%|███████████████████████████████████▍                        Processing train data:  33%|███████████████████████████████████▍                        Processing train data:  33%|███████████████████████████████████▍                        Processing train data:  33%|███████████████████████████████████▌                        Processing train data:  33%|███████████████████████████████████▌                        Processing train data:  33%|███████████████████████████████████▋                        Processing train data:  33%|███████████████████████████████████▋                        Processing train data:  33%|███████████████████████████████████▊                        Processing train data:  33%|███████████████████████████████████▊                        Processing train data:  34%|███████████████████████████████████▉                        Processing train data:  34%|███████████████████████████████████▉                        Processing train data:  34%|███████████████████████████████████▉                        Processing train data:  34%|████████████████████████████████████                        Processing train data:  34%|████████████████████████████████████                        Processing train data:  34%|████████████████████████████████████▏                       Processing train data:  34%|████████████████████████████████████▏                       Processing train data:  34%|████████████████████████████████████▎                       Processing train data:  34%|████████████████████████████████████▎                       Processing train data:  34%|████████████████████████████████████▍                       Processing train data:  34%|████████████████████████████████████▍                       Processing train data:  34%|████████████████████████████████████▌                       Processing train data:  34%|████████████████████████████████████▌                       Processing train data:  34%|████████████████████████████████████▌                       Processing train data:  34%|████████████████████████████████████▋                       Processing train data:  34%|████████████████████████████████████▋                       Processing train data:  34%|████████████████████████████████████▊                       Processing train data:  34%|████████████████████████████████████▊                       Processing train data:  34%|████████████████████████████████████▉                       Processing train data:  35%|████████████████████████████████████▉                       Processing train data:  35%|█████████████████████████████████████                       Processing train data:  35%|█████████████████████████████████████                       Processing train data:  35%|█████████████████████████████████████                       Processing train data:  35%|█████████████████████████████████████▏                      Processing train data:  35%|█████████████████████████████████████▏                      Processing train data:  35%|█████████████████████████████████████▎                      Processing train data:  35%|█████████████████████████████████████▎                      Processing train data:  35%|█████████████████████████████████████▍                      Processing train data:  35%|█████████████████████████████████████▍                      Processing train data:  35%|█████████████████████████████████████▌                      Processing train data:  35%|█████████████████████████████████████▌                      Processing train data:  35%|█████████████████████████████████████▋                      Processing train data:  35%|█████████████████████████████████████▋                      Processing train data:  35%|█████████████████████████████████████▋                      Processing train data:  35%|█████████████████████████████████████▊                      Processing train data:  35%|█████████████████████████████████████▊                      Processing train data:  35%|█████████████████████████████████████▉                      Processing train data:  36%|█████████████████████████████████████▉                      Processing train data:  36%|██████████████████████████████████████                      Processing train data:  36%|██████████████████████████████████████                      Processing train data:  36%|██████████████████████████████████████▏                     Processing train data:  36%|██████████████████████████████████████▏                     Processing train data:  36%|██████████████████████████████████████▎                     Processing train data:  36%|██████████████████████████████████████▎                     Processing train data:  36%|██████████████████████████████████████▍                     Processing train data:  36%|██████████████████████████████████████▍                     Processing train data:  36%|██████████████████████████████████████▌                     Processing train data:  36%|██████████████████████████████████████▌                     Processing train data:  36%|██████████████████████████████████████▌                     Processing train data:  36%|██████████████████████████████████████▋                     Processing train data:  36%|██████████████████████████████████████▋                     Processing train data:  36%|██████████████████████████████████████▊                     Processing train data:  36%|██████████████████████████████████████▊                     Processing train data:  36%|██████████████████████████████████████▉                     Processing train data:  36%|██████████████████████████████████████▉                     Processing train data:  36%|███████████████████████████████████████                     Processing train data:  37%|███████████████████████████████████████                     Processing train data:  37%|███████████████████████████████████████▏                    Processing train data:  37%|███████████████████████████████████████▏                    Processing train data:  37%|███████████████████████████████████████▎                    Processing train data:  37%|███████████████████████████████████████▎                    Processing train data:  37%|███████████████████████████████████████▍                    Processing train data:  37%|███████████████████████████████████████▍                    Processing train data:  37%|███████████████████████████████████████▍                    Processing train data:  37%|███████████████████████████████████████▌                    Processing train data:  37%|███████████████████████████████████████▌                    Processing train data:  37%|███████████████████████████████████████▋                    Processing train data:  37%|███████████████████████████████████████▋                    Processing train data:  37%|███████████████████████████████████████▊                    Processing train data:  37%|███████████████████████████████████████▊                    Processing train data:  37%|███████████████████████████████████████▉                    Processing train data:  37%|███████████████████████████████████████▉                    Processing train data:  37%|████████████████████████████████████████                    Processing train data:  37%|████████████████████████████████████████                    Processing train data:  38%|████████████████████████████████████████▏                   Processing train data:  38%|████████████████████████████████████████▏                   Processing train data:  38%|████████████████████████████████████████▎                   Processing train data:  38%|████████████████████████████████████████▎                   Processing train data:  38%|████████████████████████████████████████▎                   Processing train data:  38%|████████████████████████████████████████▍                   Processing train data:  38%|████████████████████████████████████████▍                   Processing train data:  38%|████████████████████████████████████████▌                   Processing train data:  38%|████████████████████████████████████████▌                   Processing train data:  38%|████████████████████████████████████████▋                   Processing train data:  38%|████████████████████████████████████████▋                   Processing train data:  38%|████████████████████████████████████████▊                   Processing train data:  38%|████████████████████████████████████████▊                   Processing train data:  38%|████████████████████████████████████████▉                   Processing train data:  38%|████████████████████████████████████████▉                   Processing train data:  38%|█████████████████████████████████████████                   Processing train data:  38%|█████████████████████████████████████████                   Processing train data:  38%|█████████████████████████████████████████▏                  Processing train data:  38%|█████████████████████████████████████████▏                  Processing train data:  39%|█████████████████████████████████████████▏                  Processing train data:  39%|█████████████████████████████████████████▎                  Processing train data:  39%|█████████████████████████████████████████▎                  Processing train data:  39%|█████████████████████████████████████████▍                  Processing train data:  39%|█████████████████████████████████████████▍                  Processing train data:  39%|█████████████████████████████████████████▌                  Processing train data:  39%|█████████████████████████████████████████▌                  Processing train data:  39%|█████████████████████████████████████████▋                  Processing train data:  39%|█████████████████████████████████████████▋                  Processing train data:  39%|█████████████████████████████████████████▋                  Processing train data:  39%|█████████████████████████████████████████▊                  Processing train data:  39%|█████████████████████████████████████████▊                  Processing train data:  39%|█████████████████████████████████████████▉                  Processing train data:  39%|█████████████████████████████████████████▉                  Processing train data:  39%|██████████████████████████████████████████                  Processing train data:  39%|██████████████████████████████████████████                  Processing train data:  39%|██████████████████████████████████████████▏                 Processing train data:  39%|██████████████████████████████████████████▏                 Processing train data:  39%|██████████████████████████████████████████▎                 Processing train data:  40%|██████████████████████████████████████████▎                 Processing train data:  40%|██████████████████████████████████████████▎                 Processing train data:  40%|██████████████████████████████████████████▍                 Processing train data:  40%|██████████████████████████████████████████▌                 Processing train data:  40%|██████████████████████████████████████████▌                 Processing train data:  40%|██████████████████████████████████████████▌                 Processing train data:  40%|██████████████████████████████████████████▋                 Processing train data:  40%|██████████████████████████████████████████▋                 Processing train data:  40%|██████████████████████████████████████████▊                 Processing train data:  40%|██████████████████████████████████████████▊                 Processing train data:  40%|██████████████████████████████████████████▉                 Processing train data:  40%|██████████████████████████████████████████▉                 Processing train data:  40%|███████████████████████████████████████████                 Processing train data:  40%|███████████████████████████████████████████                 Processing train data:  40%|███████████████████████████████████████████▏                Processing train data:  40%|███████████████████████████████████████████▏                Processing train data:  40%|███████████████████████████████████████████▏                Processing train data:  40%|███████████████████████████████████████████▎                Processing train data:  41%|███████████████████████████████████████████▎                Processing train data:  41%|███████████████████████████████████████████▍                Processing train data:  41%|███████████████████████████████████████████▍                Processing train data:  41%|███████████████████████████████████████████▌                Processing train data:  41%|███████████████████████████████████████████▌                Processing train data:  41%|███████████████████████████████████████████▋                Processing train data:  41%|███████████████████████████████████████████▋                Processing train data:  41%|███████████████████████████████████████████▋                Processing train data:  41%|███████████████████████████████████████████▊                Processing train data:  41%|███████████████████████████████████████████▊                Processing train data:  41%|███████████████████████████████████████████▉                Processing train data:  41%|███████████████████████████████████████████▉                Processing train data:  41%|████████████████████████████████████████████                Processing train data:  41%|████████████████████████████████████████████                Processing train data:  41%|████████████████████████████████████████████▏               Processing train data:  41%|████████████████████████████████████████████▏               Processing train data:  41%|████████████████████████████████████████████▎               Processing train data:  41%|████████████████████████████████████████████▎               Processing train data:  41%|████████████████████████████████████████████▍               Processing train data:  42%|████████████████████████████████████████████▍               Processing train data:  42%|████████████████████████████████████████████▌               Processing train data:  42%|████████████████████████████████████████████▌               Processing train data:  42%|████████████████████████████████████████████▌               Processing train data:  42%|████████████████████████████████████████████▋               Processing train data:  42%|████████████████████████████████████████████▋               Processing train data:  42%|████████████████████████████████████████████▊               Processing train data:  42%|████████████████████████████████████████████▊               Processing train data:  42%|████████████████████████████████████████████▉               Processing train data:  42%|████████████████████████████████████████████▉               Processing train data:  42%|█████████████████████████████████████████████               Processing train data:  42%|█████████████████████████████████████████████               Processing train data:  42%|█████████████████████████████████████████████▏              Processing train data:  42%|█████████████████████████████████████████████▏              Processing train data:  42%|█████████████████████████████████████████████▏              Processing train data:  42%|█████████████████████████████████████████████▎              Processing train data:  42%|█████████████████████████████████████████████▎              Processing train data:  42%|█████████████████████████████████████████████▍              Processing train data:  42%|█████████████████████████████████████████████▍              Processing train data:  43%|█████████████████████████████████████████████▌              Processing train data:  43%|█████████████████████████████████████████████▌              Processing train data:  43%|█████████████████████████████████████████████▋              Processing train data:  43%|█████████████████████████████████████████████▋              Processing train data:  43%|█████████████████████████████████████████████▋              Processing train data:  43%|█████████████████████████████████████████████▊              Processing train data:  43%|█████████████████████████████████████████████▊              Processing train data:  43%|█████████████████████████████████████████████▉              Processing train data:  43%|█████████████████████████████████████████████▉              Processing train data:  43%|██████████████████████████████████████████████              Processing train data:  43%|██████████████████████████████████████████████              Processing train data:  43%|██████████████████████████████████████████████▏             Processing train data:  43%|██████████████████████████████████████████████▏             Processing train data:  43%|██████████████████████████████████████████████▎             Processing train data:  43%|██████████████████████████████████████████████▎             Processing train data:  43%|██████████████████████████████████████████████▎             Processing train data:  43%|██████████████████████████████████████████████▍             Processing train data:  43%|██████████████████████████████████████████████▍             Processing train data:  43%|██████████████████████████████████████████████▌             Processing train data:  44%|██████████████████████████████████████████████▌             Processing train data:  44%|██████████████████████████████████████████████▋             Processing train data:  44%|██████████████████████████████████████████████▋             Processing train data:  44%|██████████████████████████████████████████████▊             Processing train data:  44%|██████████████████████████████████████████████▊             Processing train data:  44%|██████████████████████████████████████████████▉             Processing train data:  44%|██████████████████████████████████████████████▉             Processing train data:  44%|██████████████████████████████████████████████▉             Processing train data:  44%|███████████████████████████████████████████████             Processing train data:  44%|███████████████████████████████████████████████             Processing train data:  44%|███████████████████████████████████████████████▏            Processing train data:  44%|███████████████████████████████████████████████▏            Processing train data:  44%|███████████████████████████████████████████████▎            Processing train data:  44%|███████████████████████████████████████████████▎            Processing train data:  44%|███████████████████████████████████████████████▍            Processing train data:  44%|███████████████████████████████████████████████▍            Processing train data:  44%|███████████████████████████████████████████████▍            Processing train data:  44%|███████████████████████████████████████████████▌            Processing train data:  44%|███████████████████████████████████████████████▌            Processing train data:  45%|███████████████████████████████████████████████▋            Processing train data:  45%|███████████████████████████████████████████████▋            Processing train data:  45%|███████████████████████████████████████████████▊            Processing train data:  45%|███████████████████████████████████████████████▊            Processing train data:  45%|███████████████████████████████████████████████▉            Processing train data:  45%|███████████████████████████████████████████████▉            Processing train data:  45%|████████████████████████████████████████████████            Processing train data:  45%|████████████████████████████████████████████████            Processing train data:  45%|████████████████████████████████████████████████            Processing train data:  45%|████████████████████████████████████████████████▏           Processing train data:  45%|████████████████████████████████████████████████▏           Processing train data:  45%|████████████████████████████████████████████████▎           Processing train data:  45%|████████████████████████████████████████████████▎           Processing train data:  45%|████████████████████████████████████████████████▍           Processing train data:  45%|████████████████████████████████████████████████▍           Processing train data:  45%|████████████████████████████████████████████████▌           Processing train data:  45%|████████████████████████████████████████████████▌           Processing train data:  45%|████████████████████████████████████████████████▌           Processing train data:  45%|████████████████████████████████████████████████▋           Processing train data:  46%|████████████████████████████████████████████████▋           Processing train data:  46%|████████████████████████████████████████████████▊           Processing train data:  46%|████████████████████████████████████████████████▊           Processing train data:  46%|████████████████████████████████████████████████▉           Processing train data:  46%|████████████████████████████████████████████████▉           Processing train data:  46%|█████████████████████████████████████████████████           Processing train data:  46%|█████████████████████████████████████████████████           Processing train data:  46%|█████████████████████████████████████████████████▏          Processing train data:  46%|█████████████████████████████████████████████████▏          Processing train data:  46%|█████████████████████████████████████████████████▏          Processing train data:  46%|█████████████████████████████████████████████████▎          Processing train data:  46%|█████████████████████████████████████████████████▎          Processing train data:  46%|█████████████████████████████████████████████████▍          Processing train data:  46%|█████████████████████████████████████████████████▍          Processing train data:  46%|█████████████████████████████████████████████████▌          Processing train data:  46%|█████████████████████████████████████████████████▌          Processing train data:  46%|█████████████████████████████████████████████████▋          Processing train data:  46%|█████████████████████████████████████████████████▋          Processing train data:  46%|█████████████████████████████████████████████████▊          Processing train data:  47%|█████████████████████████████████████████████████▊          Processing train data:  47%|█████████████████████████████████████████████████▊          Processing train data:  47%|█████████████████████████████████████████████████▉          Processing train data:  47%|█████████████████████████████████████████████████▉          Processing train data:  47%|██████████████████████████████████████████████████          Processing train data:  47%|██████████████████████████████████████████████████          Processing train data:  47%|██████████████████████████████████████████████████▏         Processing train data:  47%|██████████████████████████████████████████████████▏         Processing train data:  47%|██████████████████████████████████████████████████▎         Processing train data:  47%|██████████████████████████████████████████████████▎         Processing train data:  47%|██████████████████████████████████████████████████▎         Processing train data:  47%|██████████████████████████████████████████████████▍         Processing train data:  47%|██████████████████████████████████████████████████▍         Processing train data:  47%|██████████████████████████████████████████████████▌         Processing train data:  47%|██████████████████████████████████████████████████▌         Processing train data:  47%|██████████████████████████████████████████████████▋         Processing train data:  47%|██████████████████████████████████████████████████▋         Processing train data:  47%|██████████████████████████████████████████████████▊         Processing train data:  47%|██████████████████████████████████████████████████▊         Processing train data:  48%|██████████████████████████████████████████████████▉         Processing train data:  48%|██████████████████████████████████████████████████▉         Processing train data:  48%|██████████████████████████████████████████████████▉         Processing train data:  48%|███████████████████████████████████████████████████         Processing train data:  48%|███████████████████████████████████████████████████         Processing train data:  48%|███████████████████████████████████████████████████▏        Processing train data:  48%|███████████████████████████████████████████████████▏        Processing train data:  48%|███████████████████████████████████████████████████▎        Processing train data:  48%|███████████████████████████████████████████████████▎        Processing train data:  48%|███████████████████████████████████████████████████▍        Processing train data:  48%|███████████████████████████████████████████████████▍        Processing train data:  48%|███████████████████████████████████████████████████▍        Processing train data:  48%|███████████████████████████████████████████████████▌        Processing train data:  48%|███████████████████████████████████████████████████▌        Processing train data:  48%|███████████████████████████████████████████████████▋        Processing train data:  48%|███████████████████████████████████████████████████▋        Processing train data:  48%|███████████████████████████████████████████████████▊        Processing train data:  48%|███████████████████████████████████████████████████▊        Processing train data:  48%|███████████████████████████████████████████████████▉        Processing train data:  49%|███████████████████████████████████████████████████▉        Processing train data:  49%|████████████████████████████████████████████████████        Processing train data:  49%|████████████████████████████████████████████████████        Processing train data:  49%|████████████████████████████████████████████████████        Processing train data:  49%|████████████████████████████████████████████████████▏       Processing train data:  49%|████████████████████████████████████████████████████▏       Processing train data:  49%|████████████████████████████████████████████████████▎       Processing train data:  49%|████████████████████████████████████████████████████▎       Processing train data:  49%|████████████████████████████████████████████████████▍       Processing train data:  49%|████████████████████████████████████████████████████▍       Processing train data:  49%|████████████████████████████████████████████████████▌       Processing train data:  49%|████████████████████████████████████████████████████▌       Processing train data:  49%|████████████████████████████████████████████████████▋       Processing train data:  49%|████████████████████████████████████████████████████▋       Processing train data:  49%|████████████████████████████████████████████████████▋       Processing train data:  49%|████████████████████████████████████████████████████▊       Processing train data:  49%|████████████████████████████████████████████████████▊       Processing train data:  49%|████████████████████████████████████████████████████▉       Processing train data:  49%|████████████████████████████████████████████████████▉       Processing train data:  50%|█████████████████████████████████████████████████████       Processing train data:  50%|█████████████████████████████████████████████████████       Processing train data:  50%|█████████████████████████████████████████████████████▏      Processing train data:  50%|█████████████████████████████████████████████████████▏      Processing train data:  50%|█████████████████████████████████████████████████████▏      Processing train data:  50%|█████████████████████████████████████████████████████▎      Processing train data:  50%|█████████████████████████████████████████████████████▎      Processing train data:  50%|█████████████████████████████████████████████████████▍      Processing train data:  50%|█████████████████████████████████████████████████████▍      Processing train data:  50%|█████████████████████████████████████████████████████▌      Processing train data:  50%|█████████████████████████████████████████████████████▌      Processing train data:  50%|█████████████████████████████████████████████████████▋      Processing train data:  50%|█████████████████████████████████████████████████████▋      Processing train data:  50%|█████████████████████████████████████████████████████▊      Processing train data:  50%|█████████████████████████████████████████████████████▊      Processing train data:  50%|█████████████████████████████████████████████████████▊      Processing train data:  50%|█████████████████████████████████████████████████████▉      Processing train data:  50%|█████████████████████████████████████████████████████▉      Processing train data:  51%|██████████████████████████████████████████████████████      Processing train data:  51%|██████████████████████████████████████████████████████      Processing train data:  51%|██████████████████████████████████████████████████████▏     Processing train data:  51%|██████████████████████████████████████████████████████▏     Processing train data:  51%|██████████████████████████████████████████████████████▎     Processing train data:  51%|██████████████████████████████████████████████████████▎     Processing train data:  51%|██████████████████████████████████████████████████████▎     Processing train data:  51%|██████████████████████████████████████████████████████▍     Processing train data:  51%|██████████████████████████████████████████████████████▍     Processing train data:  51%|██████████████████████████████████████████████████████▌     Processing train data:  51%|██████████████████████████████████████████████████████▌     Processing train data:  51%|██████████████████████████████████████████████████████▋     Processing train data:  51%|██████████████████████████████████████████████████████▋     Processing train data:  51%|██████████████████████████████████████████████████████▊     Processing train data:  51%|██████████████████████████████████████████████████████▊     Processing train data:  51%|██████████████████████████████████████████████████████▉     Processing train data:  51%|██████████████████████████████████████████████████████▉     Processing train data:  51%|██████████████████████████████████████████████████████▉     Processing train data:  51%|███████████████████████████████████████████████████████     Processing train data:  52%|███████████████████████████████████████████████████████     Processing train data:  52%|███████████████████████████████████████████████████████▏    Processing train data:  52%|███████████████████████████████████████████████████████▏    Processing train data:  52%|███████████████████████████████████████████████████████▎    Processing train data:  52%|███████████████████████████████████████████████████████▎    Processing train data:  52%|███████████████████████████████████████████████████████▍    Processing train data:  52%|███████████████████████████████████████████████████████▍    Processing train data:  52%|███████████████████████████████████████████████████████▌    Processing train data:  52%|███████████████████████████████████████████████████████▌    Processing train data:  52%|███████████████████████████████████████████████████████▋    Processing train data:  52%|███████████████████████████████████████████████████████▋    Processing train data:  52%|███████████████████████████████████████████████████████▊    Processing train data:  52%|███████████████████████████████████████████████████████▊    Processing train data:  52%|███████████████████████████████████████████████████████▊    Processing train data:  52%|███████████████████████████████████████████████████████▉    Processing train data:  52%|███████████████████████████████████████████████████████▉    Processing train data:  52%|████████████████████████████████████████████████████████    Processing train data:  52%|████████████████████████████████████████████████████████    Processing train data:  52%|████████████████████████████████████████████████████████▏   Processing train data:  53%|████████████████████████████████████████████████████████▏   Processing train data:  53%|████████████████████████████████████████████████████████▎   Processing train data:  53%|████████████████████████████████████████████████████████▎   Processing train data:  53%|████████████████████████████████████████████████████████▍   Processing train data:  53%|████████████████████████████████████████████████████████▍   Processing train data:  53%|████████████████████████████████████████████████████████▍   Processing train data:  53%|████████████████████████████████████████████████████████▌   Processing train data:  53%|████████████████████████████████████████████████████████▌   Processing train data:  53%|████████████████████████████████████████████████████████▋   Processing train data:  53%|████████████████████████████████████████████████████████▋   Processing train data:  53%|████████████████████████████████████████████████████████▊   Processing train data:  53%|████████████████████████████████████████████████████████▊   Processing train data:  53%|████████████████████████████████████████████████████████▉   Processing train data:  53%|████████████████████████████████████████████████████████▉   Processing train data:  53%|█████████████████████████████████████████████████████████   Processing train data:  53%|█████████████████████████████████████████████████████████   Processing train data:  53%|█████████████████████████████████████████████████████████▏  Processing train data:  53%|█████████████████████████████████████████████████████████▏  Processing train data:  54%|█████████████████████████████████████████████████████████▏  Processing train data:  54%|█████████████████████████████████████████████████████████▎  Processing train data:  54%|█████████████████████████████████████████████████████████▎  Processing train data:  54%|█████████████████████████████████████████████████████████▍  Processing train data:  54%|█████████████████████████████████████████████████████████▍  Processing train data:  54%|█████████████████████████████████████████████████████████▌  Processing train data:  54%|█████████████████████████████████████████████████████████▌  Processing train data:  54%|█████████████████████████████████████████████████████████▋  Processing train data:  54%|█████████████████████████████████████████████████████████▋  Processing train data:  54%|█████████████████████████████████████████████████████████▊  Processing train data:  54%|█████████████████████████████████████████████████████████▊  Processing train data:  54%|█████████████████████████████████████████████████████████▊  Processing train data:  54%|█████████████████████████████████████████████████████████▉  Processing train data:  54%|█████████████████████████████████████████████████████████▉  Processing train data:  54%|██████████████████████████████████████████████████████████  Processing train data:  54%|██████████████████████████████████████████████████████████  Processing train data:  54%|██████████████████████████████████████████████████████████▏ Processing train data:  54%|██████████████████████████████████████████████████████████▏ Processing train data:  54%|██████████████████████████████████████████████████████████▎ Processing train data:  55%|██████████████████████████████████████████████████████████▎ Processing train data:  55%|██████████████████████████████████████████████████████████▍ Processing train data:  55%|██████████████████████████████████████████████████████████▍ Processing train data:  55%|██████████████████████████████████████████████████████████▍ Processing train data:  55%|██████████████████████████████████████████████████████████▌ Processing train data:  55%|██████████████████████████████████████████████████████████▌ Processing train data:  55%|██████████████████████████████████████████████████████████▋ Processing train data:  55%|██████████████████████████████████████████████████████████▋ Processing train data:  55%|██████████████████████████████████████████████████████████▊ Processing train data:  55%|██████████████████████████████████████████████████████████▊ Processing train data:  55%|██████████████████████████████████████████████████████████▉ Processing train data:  55%|██████████████████████████████████████████████████████████▉ Processing train data:  55%|██████████████████████████████████████████████████████████▉ Processing train data:  55%|███████████████████████████████████████████████████████████ Processing train data:  55%|███████████████████████████████████████████████████████████ Processing train data:  55%|███████████████████████████████████████████████████████████▏Processing train data:  55%|███████████████████████████████████████████████████████████▏Processing train data:  55%|███████████████████████████████████████████████████████████▎Processing train data:  55%|███████████████████████████████████████████████████████████▎Processing train data:  56%|███████████████████████████████████████████████████████████▍Processing train data:  56%|███████████████████████████████████████████████████████████▍Processing train data:  56%|███████████████████████████████████████████████████████████▌Processing train data:  56%|███████████████████████████████████████████████████████████▌Processing train data:  56%|███████████████████████████████████████████████████████████▌Processing train data:  56%|███████████████████████████████████████████████████████████▋Processing train data:  56%|███████████████████████████████████████████████████████████▋Processing train data:  56%|███████████████████████████████████████████████████████████▊Processing train data:  56%|███████████████████████████████████████████████████████████▊Processing train data:  56%|███████████████████████████████████████████████████████████▉Processing train data:  56%|███████████████████████████████████████████████████████████▉Processing train data:  56%|████████████████████████████████████████████████████████████Processing train data:  56%|████████████████████████████████████████████████████████████Processing train data:  56%|████████████████████████████████████████████████████████████Processing train data:  56%|████████████████████████████████████████████████████████████Processing train data:  56%|████████████████████████████████████████████████████████████Processing train data:  56%|████████████████████████████████████████████████████████████Processing train data:  56%|████████████████████████████████████████████████████████████Processing train data:  56%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  57%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  58%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  59%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  60%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  61%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  62%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  63%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  64%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  65%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  66%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  67%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  68%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  69%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  70%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  71%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  72%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  73%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  74%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  75%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  76%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  77%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  78%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  79%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  80%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  81%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  82%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  83%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  84%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  85%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  86%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  87%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  88%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  89%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  90%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  91%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  92%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  93%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  94%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  95%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  96%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  97%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  98%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data:  99%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|████████████████████████████████████████████████████████████Processing train data: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 3796/3796 [03:37<00:00, 17.45it/s]
Processing eval data: 100%|███████████████████████████| 200/200 [00:11<00:00, 17.38it/s]
Loading model...
`Qwen2VLRotaryEmbedding` can now be fully parameterized by passing the model config through the `config` argument. All other arguments will be removed in v4.46
Loading checkpoint shards: 100%|██████████████████████████| 5/5 [00:02<00:00,  1.89it/s]
Loading processor...
trainable params: 80,740,352 || all params: 8,372,115,968 || trainable%: 0.9644
wandb: Using wandb-core as the SDK backend.  Please refer to https://wandb.me/wandb-core for more information.
wandb: Currently logged in as: sam-silver. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.18.7
wandb: Run data is saved locally in /home/sam/code/ucsc/243/admire/admire-finetuning-sam/wandb/run-20241204_120018-rf9vq7sc
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run qwen2-7b-instruct-trl-sft-2024-12-04_12-00-18
wandb: ⭐️ View project at https://wandb.ai/sam-silver/qwen2-7b-instruct-trl-sft
wandb: 🚀 View run at https://wandb.ai/sam-silver/qwen2-7b-instruct-trl-sft/runs/rf9vq7sc
E, B, C, A, D
/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/trl/trainer/sft_trainer.py:309: UserWarning: You didn't pass a `max_seq_length` argument to the SFTTrainer, this will default to 1024
  warnings.warn(
/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/trl/trainer/sft_trainer.py:403: UserWarning: You passed a processing_class with `padding_side` not equal to `right` to the SFTTrainer. This might lead to some unexpected behaviour due to overflow issues when training a model in half-precision. You might consider adding `processing_class.padding_side = 'right'` to your code.
  warnings.warn(
Training the model...
wandb: WARNING The `run_name` is currently set to the same value as `TrainingArguments.output_dir`. If this was not intended, please specify a different run name by setting the `TrainingArguments.run_name` parameter.
  0%|                                                           | 0/711 [00:00<?, ?it/s]`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`...
  0%|                                                 | 1/711 [00:27<5:28:13, 27.74s/it]^CTraceback (most recent call last):
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py", line 372, in <module>
    main()
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py", line 365, in main
    trainer.train()
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/trainer.py", line 2114, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/trainer.py", line 2481, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs, num_items_in_batch)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/trainer.py", line 3579, in training_step
    loss = self.compute_loss(model, inputs, num_items_in_batch=num_items_in_batch)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/trainer.py", line 3633, in compute_loss
    outputs = model(**inputs)
              ^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 823, in forward
    return model_forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 811, in __call__
    return convert_to_fp32(self.model_forward(*args, **kwargs))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/amp/autocast_mode.py", line 44, in decorate_autocast
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/peft/peft_model.py", line 1644, in forward
    return self.base_model(
           ^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/peft/tuners/tuners_utils.py", line 197, in forward
    return self.model.forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/models/qwen2_vl/modeling_qwen2_vl.py", line 1686, in forward
    image_embeds = self.visual(pixel_values, grid_thw=image_grid_thw)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/models/qwen2_vl/modeling_qwen2_vl.py", line 1049, in forward
    hidden_states = blk(hidden_states, cu_seqlens=cu_seqlens, rotary_pos_emb=rotary_pos_emb)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/models/qwen2_vl/modeling_qwen2_vl.py", line 431, in forward
    hidden_states = hidden_states + self.attn(
                                    ^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/accelerate/hooks.py", line 170, in new_forward
    output = module._old_forward(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/transformers/models/qwen2_vl/modeling_qwen2_vl.py", line 400, in forward
    attention_mask[..., cu_seqlens[i - 1] : cu_seqlens[i], cu_seqlens[i - 1] : cu_seqlens[i]] = True
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
^CException ignored in atexit callback: <function _start_and_connect_service.<locals>.teardown_atexit at 0x7f5cf0607ce0>
Traceback (most recent call last):
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/wandb/sdk/lib/service_connection.py", line 93, in teardown_atexit
    conn.teardown(hooks.exit_code)
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/wandb/sdk/lib/service_connection.py", line 216, in teardown
    return self._proc.join()
           ^^^^^^^^^^^^^^^^^
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/wandb/sdk/service/service.py", line 241, in join
    ret = self._internal_proc.wait()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/.pyenv/versions/3.12.6/lib/python3.12/subprocess.py", line 1264, in wait
    return self._wait(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sam/.pyenv/versions/3.12.6/lib/python3.12/subprocess.py", line 2053, in _wait
    (pid, sts) = self._try_wait(0)
^C         KeyboardInterrupt: 
^C^C
(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$ /home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/bin/python /home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py
  File "/home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py", line 325
    max_grad_norm=1  # Maximum norm for gradient clipping
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: invalid syntax. Perhaps you forgot a comma?
(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$ /home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/bin/python /home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/training.py
Loading dataset...
Dataset size: 3996
Processing datasets...
Processing train data: 100%|████████████████████████| 3796/3796 [03:37<00:00, 17.43it/s]
Processing eval data: 100%|███████████████████████████| 200/200 [00:11<00:00, 17.38it/s]
Loading model...
`Qwen2VLRotaryEmbedding` can now be fully parameterized by passing the model config through the `config` argument. All other arguments will be removed in v4.46
Loading checkpoint shards: 100%|██████████████████████████| 5/5 [00:02<00:00,  1.95it/s]
Loading processor...
trainable params: 80,740,352 || all params: 8,372,115,968 || trainable%: 0.9644
wandb: Using wandb-core as the SDK backend.  Please refer to https://wandb.me/wandb-core for more information.
wandb: Currently logged in as: sam-silver. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.18.7
wandb: Run data is saved locally in /home/sam/code/ucsc/243/admire/admire-finetuning-sam/wandb/run-20241204_120535-f9zgkzg8
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run qwen2-7b-instruct-trl-sft-2024-12-04_12-05-35
wandb: ⭐️ View project at https://wandb.ai/sam-silver/qwen2-7b-instruct-trl-sft
wandb: 🚀 View run at https://wandb.ai/sam-silver/qwen2-7b-instruct-trl-sft/runs/f9zgkzg8
E, B, C, A, D
/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/trl/trainer/sft_trainer.py:309: UserWarning: You didn't pass a `max_seq_length` argument to the SFTTrainer, this will default to 1024
  warnings.warn(
/home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/lib/python3.12/site-packages/trl/trainer/sft_trainer.py:403: UserWarning: You passed a processing_class with `padding_side` not equal to `right` to the SFTTrainer. This might lead to some unexpected behaviour due to overflow issues when training a model in half-precision. You might consider adding `processing_class.padding_side = 'right'` to your code.
  warnings.warn(
Training the model...
wandb: WARNING The `run_name` is currently set to the same value as `TrainingArguments.output_dir`. If this was not intended, please specify a different run name by setting the `TrainingArguments.run_name` parameter.
  0%|                                                           | 0/711 [00:00<?, ?it/s]`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`...
{'loss': 15.0893, 'grad_norm': 58.1092643737793, 'learning_rate': 2.777777777777778e-05, 'epoch': 0.04}
{'loss': 13.2746, 'grad_norm': 74.27714538574219, 'learning_rate': 5.555555555555556e-05, 'epoch': 0.08}
{'loss': 9.164, 'grad_norm': 27.97958755493164, 'learning_rate': 8.333333333333334e-05, 'epoch': 0.13}
{'loss': 7.2148, 'grad_norm': 5.240147590637207, 'learning_rate': 0.00011111111111111112, 'epoch': 0.17}
{'eval_loss': 6.797338962554932, 'eval_runtime': 228.7274, 'eval_samples_per_second': 0.874, 'eval_steps_per_second': 0.874, 'epoch': 0.17}                                     
{'loss': 6.679, 'grad_norm': 1.5700223445892334, 'learning_rate': 0.0001388888888888889, 'epoch': 0.21}                                                                         
{'loss': 6.5717, 'grad_norm': 0.7403797507286072, 'learning_rate': 0.0001666666666666667, 'epoch': 0.25}
{'loss': 6.5546, 'grad_norm': 0.7377684116363525, 'learning_rate': 0.00019444444444444446, 'epoch': 0.3}
{'loss': 6.543, 'grad_norm': 0.5023808479309082, 'learning_rate': 0.00019992266216318035, 'epoch': 0.34}
{'eval_loss': 6.539138317108154, 'eval_runtime': 219.8575, 'eval_samples_per_second': 0.91, 'eval_steps_per_second': 0.91, 'epoch': 0.34}                                       
{'loss': 6.5388, 'grad_norm': 0.496456116437912, 'learning_rate': 0.00019960868220749448, 'epoch': 0.38}                                                                        
{'loss': 6.5391, 'grad_norm': 0.522342324256897, 'learning_rate': 0.00019905398470798207, 'epoch': 0.42}
{'loss': 6.5363, 'grad_norm': 0.4618321657180786, 'learning_rate': 0.00019825991016445387, 'epoch': 0.46}
{'loss': 6.5361, 'grad_norm': 0.7031102776527405, 'learning_rate': 0.00019722837756298113, 'epoch': 0.51}
{'eval_loss': 6.531991004943848, 'eval_runtime': 220.1133, 'eval_samples_per_second': 0.909, 'eval_steps_per_second': 0.909, 'epoch': 0.51}                                     
{'loss': 6.5338, 'grad_norm': 0.5594757795333862, 'learning_rate': 0.00019596187973841217, 'epoch': 0.55}                                                                       
{'loss': 6.53, 'grad_norm': 0.6905190348625183, 'learning_rate': 0.00019446347735010763, 'epoch': 0.59}
{'loss': 6.5304, 'grad_norm': 0.3700513541698456, 'learning_rate': 0.00019273679148545245, 'epoch': 0.63}
{'loss': 6.5293, 'grad_norm': 0.47910451889038086, 'learning_rate': 0.00019078599490901984, 'epoch': 0.67}
{'eval_loss': 6.528193473815918, 'eval_runtime': 221.7754, 'eval_samples_per_second': 0.902, 'eval_steps_per_second': 0.902, 'epoch': 0.67}                                     
{'loss': 6.5302, 'grad_norm': 0.3825928568840027, 'learning_rate': 0.00018861580197853422, 'epoch': 0.72}                                                                       
{'loss': 6.5245, 'grad_norm': 0.5236403346061707, 'learning_rate': 0.00018623145725200278, 'epoch': 0.76}
{'loss': 6.5252, 'grad_norm': 0.47579723596572876, 'learning_rate': 0.00018363872281354797, 'epoch': 0.8}
{'loss': 6.5238, 'grad_norm': 0.4067441523075104, 'learning_rate': 0.0001808438643485698, 'epoch': 0.84}
{'eval_loss': 6.5253190994262695, 'eval_runtime': 219.9898, 'eval_samples_per_second': 0.909, 'eval_steps_per_second': 0.909, 'epoch': 0.84}                                    
{'loss': 6.5264, 'grad_norm': 0.4158819317817688, 'learning_rate': 0.00017785363600188894, 'epoch': 0.89}                                                                       
{'loss': 6.5215, 'grad_norm': 0.7305042743682861, 'learning_rate': 0.00017467526405546343, 'epoch': 0.93}
{'loss': 6.5222, 'grad_norm': 0.48023322224617004, 'learning_rate': 0.00017131642946512313, 'epoch': 0.97}
{'loss': 6.5218, 'grad_norm': 0.443064421415329, 'learning_rate': 0.00016778524929852512, 'epoch': 1.01}
{'eval_loss': 6.522701263427734, 'eval_runtime': 220.0327, 'eval_samples_per_second': 0.909, 'eval_steps_per_second': 0.909, 'epoch': 1.01}                                     
{'loss': 6.519, 'grad_norm': 0.5273222923278809, 'learning_rate': 0.0001640902571191869, 'epoch': 1.05}                                                                         
{'loss': 6.521, 'grad_norm': 0.5430687069892883, 'learning_rate': 0.00016024038236400246, 'epoch': 1.1}
{'loss': 6.521, 'grad_norm': 0.48276758193969727, 'learning_rate': 0.0001562449287640781, 'epoch': 1.14}
{'loss': 6.5209, 'grad_norm': 0.31427687406539917, 'learning_rate': 0.00015211355186103655, 'epoch': 1.18}
{'eval_loss': 6.519155502319336, 'eval_runtime': 220.2443, 'eval_samples_per_second': 0.908, 'eval_steps_per_second': 0.908, 'epoch': 1.18}                                     
{'loss': 6.5199, 'grad_norm': 0.4650965929031372, 'learning_rate': 0.00014785623567312492, 'epoch': 1.22}                                                                       
{'loss': 6.5187, 'grad_norm': 0.46941930055618286, 'learning_rate': 0.00014348326856751496, 'epoch': 1.26}
{'loss': 6.5198, 'grad_norm': 0.5108356475830078, 'learning_rate': 0.00013900521839710426, 'epoch': 1.31}
{'loss': 6.5183, 'grad_norm': 0.35679543018341064, 'learning_rate': 0.00013443290696190334, 'epoch': 1.35}
{'eval_loss': 6.5196919441223145, 'eval_runtime': 219.9236, 'eval_samples_per_second': 0.909, 'eval_steps_per_second': 0.909, 'epoch': 1.35}                                    
{'loss': 6.5205, 'grad_norm': 0.27067458629608154, 'learning_rate': 0.00012977738385672557, 'epoch': 1.39}                                                                      
{'loss': 6.5166, 'grad_norm': 0.46993348002433777, 'learning_rate': 0.00012504989976838132, 'epoch': 1.43}
{'loss': 6.52, 'grad_norm': 0.34716179966926575, 'learning_rate': 0.00012026187928690629, 'epoch': 1.48}
{'loss': 6.5166, 'grad_norm': 0.4857533574104309, 'learning_rate': 0.00011542489329653024, 'epoch': 1.52}
{'eval_loss': 6.5197672843933105, 'eval_runtime': 219.9739, 'eval_samples_per_second': 0.909, 'eval_steps_per_second': 0.909, 'epoch': 1.52}                                    
{'loss': 6.5198, 'grad_norm': 0.39203545451164246, 'learning_rate': 0.00011055063101310581, 'epoch': 1.56}                                                                      
{'loss': 6.5195, 'grad_norm': 0.4090125262737274, 'learning_rate': 0.00010565087173557395, 'epoch': 1.6}
{'loss': 6.5233, 'grad_norm': 0.3319472670555115, 'learning_rate': 0.00010073745637973124, 'epoch': 1.64}
{'loss': 6.5165, 'grad_norm': 0.258983314037323, 'learning_rate': 9.582225886309217e-05, 'epoch': 1.69}
{'eval_loss': 6.517827987670898, 'eval_runtime': 219.9493, 'eval_samples_per_second': 0.909, 'eval_steps_per_second': 0.909, 'epoch': 1.69}                                     
{'loss': 6.5185, 'grad_norm': 0.3592037856578827, 'learning_rate': 9.091715740999828e-05, 'epoch': 1.73}                                                                        
{'loss': 6.5198, 'grad_norm': 0.3291795551776886, 'learning_rate': 8.60340058463194e-05, 'epoch': 1.77}
{'loss': 6.5134, 'grad_norm': 0.2313789576292038, 'learning_rate': 8.118460495311686e-05, 'epoch': 1.81}
{'loss': 6.5161, 'grad_norm': 0.5793206095695496, 'learning_rate': 7.638067394849671e-05, 'epoch': 1.85}
{'eval_loss': 6.517654895782471, 'eval_runtime': 220.6439, 'eval_samples_per_second': 0.906, 'eval_steps_per_second': 0.906, 'epoch': 1.85}                                     
{'loss': 6.5173, 'grad_norm': 0.3156774044036865, 'learning_rate': 7.163382216657034e-05, 'epoch': 1.9}                                                                         
{'loss': 6.5162, 'grad_norm': 0.49345463514328003, 'learning_rate': 6.695552100196452e-05, 'epoch': 1.94}
{'loss': 6.5149, 'grad_norm': 0.3890211284160614, 'learning_rate': 6.235707618768032e-05, 'epoch': 1.98}
{'loss': 6.5189, 'grad_norm': 0.21487091481685638, 'learning_rate': 5.784960047329519e-05, 'epoch': 2.02}
{'eval_loss': 6.518862247467041, 'eval_runtime': 220.6397, 'eval_samples_per_second': 0.906, 'eval_steps_per_second': 0.906, 'epoch': 2.02}                                     
{'loss': 6.5188, 'grad_norm': 0.34295332431793213, 'learning_rate': 5.344398676953526e-05, 'epoch': 2.07}                                                                       
{'loss': 6.5196, 'grad_norm': 0.5885767936706543, 'learning_rate': 4.915088182411675e-05, 'epoch': 2.11}
{'loss': 6.5167, 'grad_norm': 0.19190330803394318, 'learning_rate': 4.498066049247344e-05, 'epoch': 2.15}
{'loss': 6.5142, 'grad_norm': 0.3364010453224182, 'learning_rate': 4.094340066554743e-05, 'epoch': 2.19}
{'eval_loss': 6.518198013305664, 'eval_runtime': 220.4634, 'eval_samples_per_second': 0.907, 'eval_steps_per_second': 0.907, 'epoch': 2.19}                                     
{'loss': 6.5209, 'grad_norm': 0.2766478955745697, 'learning_rate': 3.7048858915233664e-05, 'epoch': 2.23}                                                                       
{'loss': 6.5203, 'grad_norm': 0.24602121114730835, 'learning_rate': 3.330644691633492e-05, 'epoch': 2.28}
{'loss': 6.5152, 'grad_norm': 0.2131340354681015, 'learning_rate': 2.9725208702005734e-05, 'epoch': 2.32}
{'loss': 6.5173, 'grad_norm': 0.32606375217437744, 'learning_rate': 2.631379880765107e-05, 'epoch': 2.36}
{'eval_loss': 6.518596649169922, 'eval_runtime': 220.6765, 'eval_samples_per_second': 0.906, 'eval_steps_per_second': 0.906, 'epoch': 2.36}                                     
{'loss': 6.5156, 'grad_norm': 0.22323313355445862, 'learning_rate': 2.3080461356097937e-05, 'epoch': 2.4}                                                                       
{'loss': 6.5134, 'grad_norm': 0.2014058530330658, 'learning_rate': 2.0033010134583086e-05, 'epoch': 2.44}
{'loss': 6.5173, 'grad_norm': 0.2683621942996979, 'learning_rate': 1.7178809711703523e-05, 'epoch': 2.49}
{'loss': 6.5215, 'grad_norm': 0.20385611057281494, 'learning_rate': 1.452475763996326e-05, 'epoch': 2.53}
{'eval_loss': 6.516955375671387, 'eval_runtime': 220.695, 'eval_samples_per_second': 0.906, 'eval_steps_per_second': 0.906, 'epoch': 2.53}                                      
{'loss': 6.5175, 'grad_norm': 0.24848660826683044, 'learning_rate': 1.207726778692625e-05, 'epoch': 2.57}                                                                       
{'loss': 6.5151, 'grad_norm': 0.2302018404006958, 'learning_rate': 9.842254835257791e-06, 'epoch': 2.61}
{'loss': 6.5146, 'grad_norm': 0.42514750361442566, 'learning_rate': 7.825119989112173e-06, 'epoch': 2.66}
{'loss': 6.5142, 'grad_norm': 0.2839714586734772, 'learning_rate': 6.030737921409169e-06, 'epoch': 2.7}
{'eval_loss': 6.517272472381592, 'eval_runtime': 220.7026, 'eval_samples_per_second': 0.906, 'eval_steps_per_second': 0.906, 'epoch': 2.7}                                      
{'loss': 6.52, 'grad_norm': 0.22761353850364685, 'learning_rate': 4.463444993542721e-06, 'epoch': 2.74}                                                                         
{'loss': 6.5154, 'grad_norm': 0.17305248975753784, 'learning_rate': 3.127028775990515e-06, 'epoch': 2.78}
{'loss': 6.517, 'grad_norm': 0.38941842317581177, 'learning_rate': 2.02471889514948e-06, 'epoch': 2.82}
{'loss': 6.5157, 'grad_norm': 0.1872473508119583, 'learning_rate': 1.1591792285167603e-06, 'epoch': 2.87}
{'eval_loss': 6.51852560043335, 'eval_runtime': 220.531, 'eval_samples_per_second': 0.907, 'eval_steps_per_second': 0.907, 'epoch': 2.87}                                       
{'loss': 6.5182, 'grad_norm': 0.5205024480819702, 'learning_rate': 5.325014670776951e-07, 'epoch': 2.91}                                                                        
{'loss': 6.5175, 'grad_norm': 0.23382514715194702, 'learning_rate': 1.4620006045816815e-07, 'epoch': 2.95}
{'loss': 6.5181, 'grad_norm': 0.18935991823673248, 'learning_rate': 1.20855705696421e-09, 'epoch': 2.99}
{'train_runtime': 22171.7908, 'train_samples_per_second': 0.514, 'train_steps_per_second': 0.032, 'train_loss': 6.7869513266197234, 'epoch': 3.0}
100%|███████████████████████████████████████████████| 711/711 [6:09:31<00:00, 31.18s/it]
Saving model to qwen2-7b-instruct-trl-sft-ADMIRE...
DONE!
wandb: 🚀 View run qwen2-7b-instruct-trl-sft-2024-12-04_12-05-35 at: https://wandb.ai/sam-silver/qwen2-7b-instruct-trl-sft/runs/f9zgkzg8
wandb: Find logs at: wandb/run-20241204_120535-f9zgkzg8/logs
(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$ 

Let's analyze the run with Sonnet:

If you're looking to improve further, consider experimenting with different learning rate schedules, increasing the number of training epochs, or using techniques like data augmentation to enhance the model's performance.


Great, now let's evaluate it on the test set!
Using FINETUNED_MODEL_NAME = "UCSC-Admire/Qwen2-VL-7B-Instruct-finetune-2024-12-04_12-05-35"

In the evaluation I'm seeing a problem where the finetuned model is outputting things that are not in list. This is happening in perhaps 15% of cases.

(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$ /home/sam/code/ucsc/243/admire/admire-finetuning-sam/venv/bin/python /home/sam/code/ucsc/243/admire/admire-finetuning-sam/v2/evaluation.py
Loading test dataset...
Test dataset size: 444
Loading base model...
`Qwen2VLRotaryEmbedding` can now be fully parameterized by passing the model config through the `config` argument. All other arguments will be removed in v4.46
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:02<00:00,  2.20it/s]
Loading finetuned model...
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:02<00:00,  2.20it/s]
adapter_config.json: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 728/728 [00:00<00:00, 3.20MB/s]
adapter_model.safetensors: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 323M/323M [00:09<00:00, 35.8MB/s]

Evaluating base model...
Evaluating base model: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 444/444 [09:27<00:00,  1.28s/it]

Evaluating finetuned model...
Evaluating finetuned model:   0%|▌                                                                                                                  | 2/444 [00:02<10:57,  1.49s/it]Error evaluating ranking: 'A' is not in list
Evaluating finetuned model:   1%|▊                                                                                                                  | 3/444 [00:06<16:46,  2.28s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:   1%|█▎                                                                                                                 | 5/444 [00:11<16:36,  2.27s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:   2%|██▊                                                                                                               | 11/444 [00:21<11:45,  1.63s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:   7%|███████▍                                                                                                          | 29/444 [00:50<10:16,  1.49s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:   7%|████████▏                                                                                                         | 32/444 [00:56<12:09,  1.77s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:   8%|████████▋                                                                                                         | 34/444 [01:01<13:47,  2.02s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  14%|███████████████▉                                                                                                  | 62/444 [01:45<09:30,  1.49s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  14%|████████████████▏                                                                                                 | 63/444 [01:48<12:59,  2.05s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  15%|████████████████▉                                                                                                 | 66/444 [01:54<12:21,  1.96s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  15%|█████████████████▏                                                                                                | 67/444 [01:58<14:50,  2.36s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  16%|█████████████████▋                                                                                                | 69/444 [02:02<14:23,  2.30s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  18%|█████████████████████                                                                                             | 82/444 [02:23<08:58,  1.49s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  19%|█████████████████████▊                                                                                            | 85/444 [02:30<10:28,  1.75s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  20%|██████████████████████▌                                                                                           | 88/444 [02:36<10:57,  1.85s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  21%|████████████████████████▍                                                                                         | 95/444 [02:48<09:14,  1.59s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  22%|████████████████████████▉                                                                                         | 97/444 [02:53<11:06,  1.92s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  23%|█████████████████████████▋                                                                                       | 101/444 [03:01<10:17,  1.80s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  23%|██████████████████████████▏                                                                                      | 103/444 [03:06<11:39,  2.05s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  24%|███████████████████████████▍                                                                                     | 108/444 [03:15<09:44,  1.74s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  25%|████████████████████████████▎                                                                                    | 111/444 [03:22<10:22,  1.87s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  27%|██████████████████████████████▎                                                                                  | 119/444 [03:35<08:25,  1.56s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  28%|███████████████████████████████▊                                                                                 | 125/444 [03:46<08:35,  1.62s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  29%|█████████████████████████████████                                                                                | 130/444 [03:56<08:38,  1.65s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  30%|█████████████████████████████████▌                                                                               | 132/444 [04:01<10:15,  1.97s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  34%|██████████████████████████████████████▏                                                                          | 150/444 [04:29<07:15,  1.48s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  35%|███████████████████████████████████████▉                                                                         | 157/444 [04:41<07:26,  1.56s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  39%|████████████████████████████████████████████▎                                                                    | 174/444 [05:08<06:37,  1.47s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  42%|███████████████████████████████████████████████▎                                                                 | 186/444 [05:28<06:23,  1.49s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  44%|█████████████████████████████████████████████████▋                                                               | 195/444 [05:43<06:15,  1.51s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  44%|██████████████████████████████████████████████████▏                                                              | 197/444 [05:48<07:43,  1.87s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  46%|███████████████████████████████████████████████████▉                                                             | 204/444 [06:00<06:15,  1.57s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  47%|████████████████████████████████████████████████████▋                                                            | 207/444 [06:06<07:01,  1.78s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  49%|███████████████████████████████████████████████████████▏                                                         | 217/444 [06:22<05:42,  1.51s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  50%|█████████████████████████████████████████████████████████                                                        | 224/444 [06:35<05:37,  1.53s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  51%|█████████████████████████████████████████████████████████▎                                                       | 225/444 [06:38<07:27,  2.04s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  51%|█████████████████████████████████████████████████████████▌                                                       | 226/444 [06:41<08:46,  2.42s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  54%|████████████████████████████████████████████████████████████▌                                                    | 238/444 [07:01<05:12,  1.52s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  54%|█████████████████████████████████████████████████████████████▎                                                   | 241/444 [07:07<06:01,  1.78s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  55%|█████████████████████████████████████████████████████████████▌                                                   | 242/444 [07:10<07:31,  2.23s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  55%|██████████████████████████████████████████████████████████████                                                   | 244/444 [07:15<07:32,  2.26s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  56%|███████████████████████████████████████████████████████████████▎                                                 | 249/444 [07:25<05:50,  1.80s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  56%|███████████████████████████████████████████████████████████████▋                                                 | 250/444 [07:28<07:20,  2.27s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  59%|██████████████████████████████████████████████████████████████████▏                                              | 260/444 [07:45<04:47,  1.56s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  60%|████████████████████████████████████████████████████████████████████▏                                            | 268/444 [07:59<04:35,  1.57s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  61%|████████████████████████████████████████████████████████████████████▍                                            | 269/444 [08:03<06:03,  2.08s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  61%|████████████████████████████████████████████████████████████████████▋                                            | 270/444 [08:06<07:05,  2.45s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  61%|█████████████████████████████████████████████████████████████████████▍                                           | 273/444 [08:12<05:57,  2.09s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  63%|███████████████████████████████████████████████████████████████████████▌                                         | 281/444 [08:26<04:12,  1.55s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  65%|█████████████████████████████████████████████████████████████████████████▎                                       | 288/444 [08:38<04:02,  1.55s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  66%|██████████████████████████████████████████████████████████████████████████▊                                      | 294/444 [08:49<03:54,  1.57s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  69%|█████████████████████████████████████████████████████████████████████████████▌                                   | 305/444 [09:07<03:26,  1.49s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  70%|██████████████████████████████████████████████████████████████████████████████▉                                  | 310/444 [09:16<03:35,  1.61s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  71%|███████████████████████████████████████████████████████████████████████████████▉                                 | 314/444 [09:24<03:40,  1.70s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  73%|█████████████████████████████████████████████████████████████████████████████████▉                               | 322/444 [09:37<03:06,  1.53s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  76%|██████████████████████████████████████████████████████████████████████████████████████                           | 338/444 [10:03<02:36,  1.48s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  82%|████████████████████████████████████████████████████████████████████████████████████████████▍                    | 363/444 [10:41<01:58,  1.47s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  84%|██████████████████████████████████████████████████████████████████████████████████████████████▉                  | 373/444 [10:58<01:46,  1.49s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  84%|███████████████████████████████████████████████████████████████████████████████████████████████▍                 | 375/444 [11:03<02:09,  1.87s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  85%|████████████████████████████████████████████████████████████████████████████████████████████████▏                | 378/444 [11:09<02:03,  1.88s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  87%|██████████████████████████████████████████████████████████████████████████████████████████████████▋              | 388/444 [11:25<01:24,  1.51s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  88%|███████████████████████████████████████████████████████████████████████████████████████████████████              | 389/444 [11:29<01:51,  2.03s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  88%|███████████████████████████████████████████████████████████████████████████████████████████████████▎             | 390/444 [11:32<02:10,  2.41s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  90%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 398/444 [11:46<01:12,  1.57s/it]Error evaluating ranking: 'D' is not in list
Evaluating finetuned model:  92%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌         | 407/444 [12:01<00:55,  1.50s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model:  93%|████████████████████████████████████████████████████████████████████████████████████████████████████████▌        | 411/444 [12:08<00:55,  1.67s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  93%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▎       | 414/444 [12:14<00:54,  1.80s/it]Error evaluating ranking: 'E' is not in list
Evaluating finetuned model:  94%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▏      | 417/444 [12:21<00:50,  1.85s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▏   | 429/444 [12:40<00:22,  1.49s/it]Error evaluating ranking: 'C' is not in list
Evaluating finetuned model:  98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▉  | 436/444 [12:52<00:12,  1.53s/it]Error evaluating ranking: 'B' is not in list
Evaluating finetuned model: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 444/444 [13:06<00:00,  1.77s/it]

Evaluation Results:
==================================================
Base Model:
Top-1 Accuracy: 0.2050
Spearman Correlation: -0.0239
--------------------------------------------------
Finetuned Model:
Top-1 Accuracy: 0.1577
Spearman Correlation: -0.0142
==================================================
(venv) sam@pop-os:~/code/ucsc/243/admire/admire-finetuning-sam$ 

Uh oh! Let's try to encourage it to use all of the aliases and not repeat any.
(Small update to prompt...)
Added:     Make sure that all aliases are used in your ranking, and that each is used exactly once.


Rerunning...

Still a lot of 
Evaluating finetuned model:  26%|█████████████████████████████▎                                                                                   | 115/444 [03:31<09:27,  1.72s/it]
Prediction: ['A']
Ground truth: ['A', 'E', 'B', 'D', 'C']

Maybe specifically saying that "A" isn't an acceptable response will help?...
(Leaving evaluation for this running)
Evaluation Results:
==================================================
Base Model:
Top-1 Accuracy: 0.1802
Spearman Correlation: -0.0104
--------------------------------------------------
Finetuned Model:
Top-1 Accuracy: 0.1486
Spearman Correlation: -0.0300
==================================================

Okay, tweaking prompt...
Adding:
    A response of a single alias (e.g. "A") is NOT an acceptable response; include all 5 aliasses in relevancy order (descending).

(Leaving this running...)
==================================================
Base Model:
Top-1 Accuracy: 0.1802
Spearman Correlation: -0.0088
--------------------------------------------------
Finetuned Model:
Top-1 Accuracy: 0.1712
Spearman Correlation: 0.0160
==================================================

Weird! So sometimes the Spearman Corelation gets better, but top-1 gets worse.

Let's try retraining the model again...

